<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>M.A.R.K. v9.97 | Page Terminal</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <style>
        :root {
            /* Luxury Palette */
            --navy: #1e3a5f;
            --navy-light: #2d4a6f;
            --navy-dark: #152a45;
            --gold: #c9a962;
            --gold-light: #d4bc7d;
            --gold-dark: #b8954d;
            --cream: #fdfbf7;
            --white: #ffffff;
            --text-primary: #1a1a2e;
            --text-secondary: #64748b;
            --text-muted: #94a3b8;
            --border-light: #e8e4dc;
            --shadow-soft: rgba(30, 58, 95, 0.08);
            --shadow-medium: rgba(30, 58, 95, 0.12);
            
            /* Legacy compatibility */
            --primary: var(--navy);
            --primary-light: var(--navy-light);
            --accent: var(--gold);
            --danger: #dc2626;
            --phase-complete: var(--gold);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--cream);
            color: var(--text-primary);
            line-height: 1.6;
            padding-bottom: 80px;
        }

        /* ===== BOOT SEQUENCE OVERLAY ===== */
        .boot-overlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: linear-gradient(135deg, var(--navy-dark) 0%, var(--navy) 100%);
            z-index: 9999;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: opacity 0.6s ease, visibility 0.6s ease;
        }
        .boot-overlay.hidden {
            opacity: 0;
            visibility: hidden;
        }
        .boot-logo {
            font-family: 'Inter', sans-serif;
            font-size: 56px;
            font-weight: 200;
            letter-spacing: 8px;
            color: var(--white);
            margin-bottom: 40px;
            animation: bootPulse 2s ease-in-out infinite;
        }
        .boot-logo span {
            color: var(--gold);
            font-weight: 300;
        }
        .boot-text {
            font-family: 'Inter', sans-serif;
            font-size: 13px;
            font-weight: 400;
            letter-spacing: 1px;
            color: var(--gold-light);
            text-align: center;
            line-height: 2;
            text-transform: uppercase;
        }
        .boot-text div {
            opacity: 0;
            animation: bootFadeIn 0.4s forwards;
        }
        @keyframes bootPulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
        }
        @keyframes bootFadeIn {
            to { opacity: 1; }
        }

        /* ===== STATUS BAR ===== */
        .status-bar {
            background: linear-gradient(90deg, var(--navy-dark), var(--navy), var(--navy-dark));
            background-size: 200% 100%;
            animation: statusGradient 8s ease infinite;
            border-bottom: 1px solid var(--gold);
            padding: 12px 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 40px;
            font-size: 11px;
            font-weight: 500;
            letter-spacing: 0.5px;
            text-transform: uppercase;
            position: relative;
            overflow: hidden;
        }
        .status-bar::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(201,169,98,0.1), transparent);
            animation: statusSweep 4s ease-in-out infinite;
        }
        @keyframes statusGradient {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }
        @keyframes statusSweep {
            0% { left: -100%; }
            100% { left: 100%; }
        }
        .status-item {
            display: flex;
            align-items: center;
            gap: 8px;
            color: rgba(255,255,255,0.6);
        }
        .status-item.online {
            color: var(--white);
        }
        .status-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: var(--gold);
            animation: statusPulse 2s ease-in-out infinite;
            box-shadow: 0 0 8px var(--gold);
        }
        @keyframes statusPulse {
            0%, 100% { opacity: 1; box-shadow: 0 0 8px var(--gold); }
            50% { opacity: 0.6; box-shadow: 0 0 4px var(--gold); }
        }
        .status-clock {
            color: var(--gold);
            font-weight: 600;
            font-family: 'JetBrains Mono', monospace;
            font-size: 11px;
        }

        /* ===== HEADER ===== */
        .ai-header {
            background: linear-gradient(135deg, var(--white) 0%, var(--cream) 100%);
            color: var(--navy);
            padding: 50px 20px;
            position: relative;
            overflow: hidden;
            border-bottom: 2px solid var(--gold);
        }

        /* Subtle animated shimmer */
        .ai-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 50%;
            height: 100%;
            background: linear-gradient(90deg, 
                transparent 0%, 
                rgba(201,169,98,0.08) 50%, 
                transparent 100%);
            animation: headerShimmer 12s ease-in-out infinite;
        }
        
        @keyframes headerShimmer {
            0% { left: -50%; }
            100% { left: 150%; }
        }

        /* Gold accent line at bottom */
        .ai-header::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, var(--gold-dark), var(--gold-light), var(--gold-dark));
            background-size: 200% 100%;
            animation: goldFlow 8s ease-in-out infinite;
        }
        
        @keyframes goldFlow {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        /* Floating gold particles - slower and more subtle */
        .header-particles {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            overflow: hidden;
            pointer-events: none;
        }
        
        .particle {
            position: absolute;
            width: 3px;
            height: 3px;
            background: var(--gold);
            border-radius: 50%;
            opacity: 0;
            animation: particleFloat 16s ease-in-out infinite;
        }
        
        .particle:nth-child(1) { left: 10%; animation-delay: 0s; }
        .particle:nth-child(2) { left: 30%; animation-delay: 4s; }
        .particle:nth-child(3) { left: 50%; animation-delay: 8s; }
        .particle:nth-child(4) { left: 70%; animation-delay: 2s; }
        .particle:nth-child(5) { left: 90%; animation-delay: 6s; }
        .particle:nth-child(6) { left: 20%; animation-delay: 10s; }
        .particle:nth-child(7) { left: 60%; animation-delay: 12s; }
        .particle:nth-child(8) { left: 80%; animation-delay: 14s; }
        
        @keyframes particleFloat {
            0% { 
                transform: translateY(60px) scale(0);
                opacity: 0;
            }
            10% { 
                opacity: 0.4;
            }
            90% {
                opacity: 0.4;
            }
            100% { 
                transform: translateY(-60px) scale(0.5);
                opacity: 0;
            }
        }

        /* Soft glowing orbs */
        .header-glow {
            position: absolute;
            border-radius: 50%;
            filter: blur(80px);
            opacity: 0.15;
            animation: glowPulse 10s ease-in-out infinite;
        }
        
        .header-glow.glow-1 {
            width: 250px;
            height: 250px;
            background: var(--gold);
            top: -100px;
            left: 5%;
            animation-delay: 0s;
        }
        
        .header-glow.glow-2 {
            width: 200px;
            height: 200px;
            background: var(--navy-light);
            bottom: -80px;
            right: 10%;
            animation-delay: 3s;
        }
        
        .header-glow.glow-3 {
            width: 150px;
            height: 150px;
            background: var(--gold-light);
            top: 30%;
            right: 25%;
            animation-delay: 6s;
        }
        
        @keyframes glowPulse {
            0%, 100% { opacity: 0.1; transform: scale(1); }
            50% { opacity: 0.2; transform: scale(1.05); }
        }

        .header-content {
            position: relative; z-index: 1; max-width: 900px; margin: 0 auto;
            display: flex; justify-content: space-between; align-items: center;
        }

        .header-title h1 { font-size: 28px; font-weight: 800; display: flex; align-items: center; gap: 12px; }
        .header-badge { background: var(--accent); padding: 6px 14px; border-radius: 20px; font-size: 12px; font-weight: 700; }

        /* ===== PROGRESS STICKY ===== */
        .progress-sticky {
            position: sticky; top: 0; z-index: 1000;
            background: var(--white);
            border-bottom: 1px solid var(--border-light);
            padding: 16px 0;
            box-shadow: 0 2px 8px var(--shadow-soft);
        }

        .progress-wrapper {
            max-width: 900px; margin: 0 auto; padding: 0 20px;
            display: flex; align-items: center; justify-content: space-between;
        }

        .progress-stats {
            font-family: 'JetBrains Mono', monospace; font-size: 12px;
            color: var(--navy); font-weight: 600;
        }

        .progress-bar-container {
            flex: 1; margin: 0 20px; height: 6px;
            background: var(--border-light); border-radius: 3px; overflow: hidden;
        }

        .progress-fill {
            height: 100%; 
            background: linear-gradient(90deg, var(--navy) 0%, var(--gold) 100%);
            width: 0%; 
            transition: width 0.5s ease;
            border-radius: 3px;
        }

        /* ===== CONTAINER ===== */
        .container { max-width: 900px; margin: 30px auto; padding: 0 20px; }

        /* ===== LUXURY CARDS ===== */
        .card {
            background: var(--white);
            border-radius: 12px;
            border: 1px solid var(--border-light);
            box-shadow: 0 2px 8px var(--shadow-soft);
            margin-bottom: 20px; 
            overflow: hidden;
            transition: box-shadow 0.3s ease, transform 0.3s ease;
        }
        .card:hover {
            box-shadow: 0 4px 20px var(--shadow-medium);
        }

        /* ===== PHASE STATES ===== */
        .phase.phase-complete {
            border-color: var(--gold);
            box-shadow: 0 2px 12px rgba(201, 169, 98, 0.15);
        }
        .phase.phase-complete .phase-header {
            background: linear-gradient(135deg, #fdfbf7 0%, #f9f6f0 100%);
            border-left: 3px solid var(--gold);
        }
        .phase.phase-complete .phase-num {
            background: var(--gold);
            color: var(--white);
        }
        .phase.phase-complete::after {
            content: '✓';
            position: absolute;
            top: 18px;
            right: 20px;
            background: var(--gold);
            color: var(--white);
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: 700;
        }
        .phase { position: relative; }

        /* Phase Unlocking Animation */
        .phase.phase-unlocking {
            animation: phaseUnlock 0.5s ease;
        }
        @keyframes phaseUnlock {
            0% { opacity: 0.7; transform: translateY(-5px); }
            100% { opacity: 1; transform: translateY(0); }
        }

        /* Active Phase */
        .phase.active {
            border-color: var(--navy);
            box-shadow: 0 2px 16px var(--shadow-medium);
        }
        .phase.active .phase-num {
            background: var(--navy);
            box-shadow: 0 0 0 3px rgba(30, 58, 95, 0.15);
        }

        /* ===== 100% COMPLETION CELEBRATION ===== */
        .completion-overlay {
            display: none;
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: linear-gradient(135deg, rgba(21, 42, 69, 0.97) 0%, rgba(30, 58, 95, 0.97) 100%);
            z-index: 9999;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }
        .completion-overlay.active { display: flex; }
        .completion-box {
            border: 2px solid var(--gold);
            border-radius: 16px;
            padding: 50px 70px;
            text-align: center;
            background: var(--white);
            box-shadow: 0 25px 80px rgba(0, 0, 0, 0.4);
        }
        .completion-title {
            font-family: 'Inter', sans-serif;
            font-size: 28px;
            font-weight: 300;
            letter-spacing: 4px;
            color: var(--navy);
            margin-bottom: 30px;
            text-transform: uppercase;
        }
        .completion-title span {
            color: var(--gold);
        }
        .completion-stats {
            font-family: 'Inter', sans-serif;
            font-size: 14px;
            color: var(--text-secondary);
            line-height: 2.2;
            margin-bottom: 35px;
        }
        .completion-stats span {
            color: var(--navy);
            font-weight: 600;
        }
        .completion-close {
            background: linear-gradient(135deg, var(--gold) 0%, var(--gold-dark) 100%);
            color: var(--white);
            border: none;
            padding: 14px 50px;
            border-radius: 6px;
            font-family: 'Inter', sans-serif;
            font-weight: 600;
            font-size: 13px;
            letter-spacing: 1px;
            text-transform: uppercase;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .completion-close:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(201, 169, 98, 0.4);
        }
        /* Confetti */
        .confetti {
            position: absolute;
            width: 8px;
            height: 8px;
            opacity: 0;
        }
        .confetti.active {
            animation: confettiFall 3s ease-out forwards;
        }
        @keyframes confettiFall {
            0% { opacity: 1; transform: translateY(-100vh) rotate(0deg); }
            100% { opacity: 0; transform: translateY(100vh) rotate(720deg); }
        }

        /* ===== SETUP SECTION ===== */
        .setup-section { 
            padding: 30px; 
            border-left: 3px solid var(--gold);
            background: var(--white);
        }

        .input-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px; }
        .input-grid-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; margin-bottom: 20px; }

        .form-group label {
            display: block; font-size: 11px; font-weight: 600;
            text-transform: uppercase; 
            letter-spacing: 0.5px;
            color: var(--text-secondary); 
            margin-bottom: 8px;
        }

        .form-group input, .form-group textarea {
            width: 100%; padding: 12px 14px;
            border: 1px solid var(--border-light); 
            border-radius: 6px;
            font-family: 'Inter', sans-serif; 
            font-size: 14px;
            background: var(--white);
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
        }

        .form-group input:focus, .form-group textarea:focus {
            outline: none; 
            border-color: var(--navy);
            box-shadow: 0 0 0 3px rgba(30, 58, 95, 0.1);
        }

        .form-group input[readonly] { 
            background: var(--cream); 
            color: var(--text-secondary);
            border-style: dashed;
        }

        /* ===== PHASE HEADERS ===== */
        .phase-header {
            padding: 20px 25px; 
            background: var(--white);
            border-bottom: 1px solid var(--border-light); 
            cursor: pointer;
            display: flex; 
            justify-content: space-between; 
            align-items: center;
            transition: background 0.2s ease;
        }
        .phase-header:hover { background: var(--cream); }
        .phase-title { 
            font-size: 15px; 
            font-weight: 600; 
            color: var(--navy);
            display: flex; 
            align-items: center; 
            gap: 14px; 
        }
        
        .phase-num {
            background: var(--navy); 
            color: var(--white);
            width: 28px; 
            height: 28px; 
            border-radius: 50%;
            display: flex; 
            align-items: center; 
            justify-content: center;
            font-size: 13px; 
            font-weight: 700;
            transition: all 0.3s ease;
        }

        .phase-time {
            font-size: 12px;
            color: var(--text-muted);
            font-weight: 500;
        }

        .phase-content { padding: 25px; display: none; background: var(--white); }
        .phase.active .phase-content { display: block; }
        .phase.active .phase-header { 
            background: var(--cream); 
            border-left: 3px solid var(--gold); 
        }

        /* ===== STEPS ===== */
        .step {
            display: flex; gap: 15px; padding: 14px 16px;
            border-radius: 8px; margin-bottom: 10px;
            border: 1px solid transparent; 
            transition: all 0.2s ease;
            align-items: flex-start;
            background: var(--white);
        }
        .step > div { flex: 1; }
        .step input[type="checkbox"] { 
            order: 2; 
            width: 20px; 
            height: 20px; 
            accent-color: var(--gold); 
            cursor: pointer; 
            margin-top: 2px; 
            flex-shrink: 0; 
        }
        .step:hover { 
            background: var(--cream); 
            border-color: var(--border-light); 
        }
        .step.checked { 
            background: #fdfbf7; 
            border-color: var(--gold);
            border-left: 3px solid var(--gold);
        }
        .step-label { font-weight: 500; font-size: 14px; cursor: pointer; color: var(--text-primary); }
        .step-sub { font-size: 12px; color: var(--text-secondary); margin-top: 4px; }

        /* ===== BUTTONS ===== */
        .btn {
            display: inline-flex; align-items: center; gap: 8px;
            padding: 10px 18px; border-radius: 6px;
            font-size: 13px; font-weight: 600; border: none; cursor: pointer;
            transition: all 0.2s ease;
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }
        .btn:active { transform: scale(0.98); }
        .btn-primary { background: var(--navy); color: var(--white); }
        .btn-primary:hover { background: var(--navy-dark); box-shadow: 0 4px 12px rgba(30, 58, 95, 0.3); }
        .btn-accent { background: var(--gold); color: var(--white); }
        .btn-accent:hover { background: var(--gold-dark); box-shadow: 0 4px 12px rgba(201, 169, 98, 0.3); }
        .btn-ghost { background: var(--cream); color: var(--navy); border: 1px solid var(--border-light); }
        .btn-ghost:hover { background: var(--white); border-color: var(--navy); }
        .btn-danger { background: #dc2626; color: white; }
        .btn-danger:hover { background: #b91c1c; }

        /* ===== BOXES ===== */
        .data-box { 
            background: var(--cream); 
            border: 1px solid var(--border-light); 
            border-radius: 8px; 
            padding: 20px; 
            margin: 15px 0; 
        }
        
        .success-box {
            background: #f8fdf9; 
            border: 1px solid #d1e7d5;
            border-left: 3px solid var(--gold); 
            padding: 15px;
            border-radius: 6px; 
            color: var(--text-primary); 
            font-size: 13px; 
            margin-top: 10px;
        }

        .warning-box {
            background: #fef7f7; 
            border: 1px solid #f5d5d5;
            border-left: 3px solid #dc2626; 
            padding: 15px;
            border-radius: 6px; 
            color: var(--text-primary); 
            font-size: 13px; 
            margin-top: 10px;
        }

        .info-box {
            background: #fdfbf7; 
            border: 1px solid var(--border-light);
            border-left: 3px solid var(--gold); 
            padding: 15px;
            border-radius: 6px; 
            color: var(--text-primary); 
            font-size: 13px;
        }

        /* ===== GMB PARSED DISPLAY ===== */
        .gmb-parsed {
            background: var(--white); 
            border: 1px solid var(--border-light);
            border-left: 3px solid var(--gold);
            border-radius: 8px; 
            padding: 20px; 
            margin-top: 15px;
        }

        .gmb-field {
            display: grid; grid-template-columns: 100px 1fr;
            gap: 10px; padding: 8px 0;
            border-bottom: 1px solid var(--border-light);
            font-size: 13px;
        }
        .gmb-field:last-child { border-bottom: none; }
        .gmb-field-label { 
            font-weight: 600; 
            text-transform: uppercase; 
            color: var(--gold-dark); 
            font-size: 10px; 
            letter-spacing: 0.5px;
        }
        .gmb-field-value { 
            color: var(--text-primary); 
            font-family: 'JetBrains Mono', monospace; 
            font-size: 12px; 
        }

        /* ===== CID BOX ===== */
        .cid-box {
            background: var(--cream); 
            border: 1px solid var(--border-light);
            border-left: 3px solid var(--gold);
            border-radius: 8px; 
            padding: 15px; 
            margin-top: 15px;
        }

        .cid-display {
            font-family: 'JetBrains Mono', monospace;
            font-size: 11px; 
            background: var(--navy); 
            color: var(--gold-light);
            padding: 10px 14px; 
            border-radius: 6px; 
            word-break: break-all;
            margin: 10px 0;
        }

        /* ===== SCHEMA VALIDATOR ===== */
        .code-check-area {
            background: var(--navy-dark); 
            color: #e2e8f0;
            font-family: 'JetBrains Mono', monospace;
            font-size: 12px; 
            width: 100%; 
            height: 100px;
            padding: 12px; 
            border-radius: 6px; 
            border: 1px solid var(--navy);
            margin-top: 8px; 
            resize: vertical;
        }

        .schema-results { 
            margin-top: 15px; 
            padding: 15px; 
            border-radius: 6px; 
            font-size: 13px; 
        }
        .schema-results.pass { 
            background: #f8fdf9; 
            border: 1px solid #d1e7d5; 
        }
        .schema-results.fail { 
            background: #fef7f7; 
            border: 1px solid #f5d5d5; 
        }

        .schema-check-item { display: flex; align-items: center; gap: 8px; padding: 4px 0; }
        .schema-check-item.pass { color: var(--gold-dark); }
        .schema-check-item.fail { color: #dc2626; }

        /* ===== QUICK LINKS ===== */
        .quick-links { display: flex; gap: 10px; flex-wrap: wrap; margin: 10px 0; }

        .quick-link {
            display: inline-flex; align-items: center; gap: 6px;
            padding: 10px 16px; 
            background: var(--white);
            border: 1px solid var(--border-light); 
            border-radius: 6px;
            font-size: 12px; 
            font-weight: 600; 
            color: var(--navy);
            text-decoration: none; 
            transition: all 0.2s;
        }
        .quick-link:hover { 
            background: var(--navy); 
            color: var(--white); 
            border-color: var(--navy); 
        }

        .quick-link.secondary {
            background: var(--cream); 
            border-color: var(--border-light); 
            color: var(--text-secondary);
        }
        .quick-link.secondary:hover { 
            background: var(--gold); 
            color: var(--white);
            border-color: var(--gold);
        }

        /* ===== TOAST ===== */
        .toast {
            position: fixed; bottom: 30px; right: 30px;
            background: var(--navy); 
            color: var(--white);
            padding: 14px 24px; 
            border-radius: 6px;
            box-shadow: 0 10px 40px rgba(30, 58, 95, 0.3);
            display: flex; align-items: center; gap: 10px;
            transform: translateY(100px); 
            transition: transform 0.3s ease; 
            z-index: 2000;
            font-size: 13px;
            font-weight: 500;
        }
        .toast.show { transform: translateY(0); }

        .divider { border-top: 1px solid var(--border-light); margin: 20px 0; }

        .instruction-box {
            background: #faf5ff; border: 1px solid #d8b4fe;
            border-left: 4px solid #9333ea; padding: 12px 15px;
            border-radius: 8px; font-size: 13px; margin: 10px 0;
        }
        .instruction-box code { background: #f3e8ff; padding: 2px 6px; border-radius: 4px; font-family: 'JetBrains Mono', monospace; font-size: 12px; }

        /* Part Headers */
        .part-header {
            background: linear-gradient(90deg, var(--primary), var(--primary-light));
            color: white; padding: 10px 15px; border-radius: 8px;
            font-weight: 700; font-size: 14px; margin-bottom: 15px;
            display: flex; align-items: center; gap: 10px;
        }

        /* Rebuild Issue Input */
        .rebuild-input {
            width: 100%; padding: 10px; border: 2px solid #fecaca;
            border-radius: 8px; font-family: 'Inter', sans-serif;
            margin: 10px 0; min-height: 60px;
        }
    </style>
</head>
<body>

    <!-- BOOT SEQUENCE OVERLAY -->
    <div class="boot-overlay" id="bootOverlay">
        <div class="boot-logo">M.A.R.K<span>.</span></div>
        <div class="boot-text" id="bootText"></div>
    </div>

    <!-- STATUS BAR -->
    <div class="status-bar">
        <div class="status-item online">
            <div class="status-dot"></div>
            <span>Online</span>
        </div>
        <div class="status-item">
            <span>M.A.R.K. v9.97</span>
        </div>
        <div class="status-item">
            <span class="status-clock" id="statusClock">00:00:00</span>
        </div>
        <div class="status-item" id="phaseStatus">
            <span>Phase <span id="currentPhaseNum">1</span> of 9</span>
        </div>
    </div>

    <header class="ai-header">
        <!-- Animated background elements -->
        <div class="header-glow glow-1"></div>
        <div class="header-glow glow-2"></div>
        <div class="header-glow glow-3"></div>
        <div class="header-particles">
            <div class="particle"></div>
            <div class="particle"></div>
            <div class="particle"></div>
            <div class="particle"></div>
            <div class="particle"></div>
            <div class="particle"></div>
            <div class="particle"></div>
            <div class="particle"></div>
        </div>
        
        <div class="header-content" style="align-items: center;">
            <div>
                <div style="font-size:10px; font-weight:500; color:var(--gold-dark); letter-spacing:3px; margin-bottom:8px; text-transform:uppercase;">
                    Machine Assisted Routing Kit
                </div>
                <h1 style="font-size:32px; font-weight:300; letter-spacing:1px; margin:0; color:var(--navy);">
                    M.A.R.K<span style="color:var(--gold);">.</span> <span style="font-weight:500; font-size:18px; color:var(--text-muted);">v9.97</span>
                </h1>
            </div>
            <div style="text-align:right;">
                <div style="font-size:11px; font-weight:600; color:var(--gold-dark); margin-bottom:6px; text-transform:uppercase; letter-spacing:1px;">Page Terminal</div>
                <div style="font-size:10px; color:var(--text-muted); line-height:1.6;">
                    <div>GEO-PARSE™ Engine</div>
                    <div>CID Protocol • Schema Module</div>
                </div>
            </div>
        </div>
    </header>

    <div class="progress-sticky">
        <div class="progress-wrapper">
            <div class="progress-stats" id="timerDisplay">00:00</div>
            <div class="progress-bar-container">
                <div class="progress-fill" id="progressBar"></div>
            </div>
            <div class="progress-stats" id="percentDisplay">0%</div>
        </div>
    </div>

    <div class="container">
        
        <!-- MISSION CONTROL -->
        <div class="card setup-section">
            <div style="display:flex; justify-content:space-between; margin-bottom:20px;">
                <h2 style="color:var(--primary); font-size:18px;">⚙️ Mission Control</h2>
                <button class="btn btn-ghost" onclick="resetAll()" style="border-color: #ef4444;"><span style="color:#ef4444;">⚠️</span> Reset System</button>
            </div>

            <div class="input-grid">
                <div class="form-group">
                    <label>VA Name</label>
                    <input type="text" id="vaName" placeholder="Enter Name">
                </div>
                <div class="form-group">
                    <label>Target URL</label>
                    <input type="text" id="pageURL" placeholder="https://www.stselectronicrecyclinginc.com/...">
                </div>
            </div>

            <div style="text-align: center;">
                <button class="btn btn-primary" onclick="extractData()">
                    <i class="fas fa-search-location"></i> Initialize & Extract Data
                </button>
            </div>

            <!-- DATA AREA -->
            <div id="dataArea" style="display:none; margin-top:20px;">
                <div class="data-box">
                    <div class="input-grid-3">
                        <div class="form-group">
                            <label>Detected City</label>
                            <input type="text" id="cityName" style="background: white;">
                        </div>
                        <div class="form-group">
                            <label>State (from GMB)</label>
                            <input type="text" id="stateName" placeholder="Auto-detected from GMB" style="background: white;">
                        </div>
                        <div class="form-group">
                            <label>Niche (from URL)</label>
                            <input type="text" id="stsKeyword" value="Electronics Recycling">
                        </div>
                    </div>
                    
                    <div class="divider"></div>

                    <!-- FIND GMB BUTTON FIRST -->
                    <div style="text-align:center; margin-bottom:15px;">
                        <button class="btn btn-accent" onclick="searchGMB()">
                            <i class="fas fa-map-marked-alt"></i> Find GMB (Google Maps)
                        </button>
                        <div style="color: #ef4444; font-size: 12px; font-weight: 600; margin-top: 8px;">
                            <i class="fas fa-exclamation-triangle"></i> OPEN THE HOURS DROP-DOWN before copying!
                        </div>
                    </div>

                    <!-- GMB URL (full width) -->
                    <div class="form-group">
                        <label>GMB Long URL (Paste full Google Maps URL)</label>
                        <textarea id="gmbURL" style="height:50px;" placeholder="Paste the entire Google Maps URL here..."></textarea>
                    </div>

                    <div class="form-group" style="margin-top:15px;">
                        <label>GMB Raw Data (Copy entire page)</label>
                        <textarea id="gmbData" style="height:80px;" placeholder="Select all & copy the entire GMB listing page..."></textarea>
                        <div style="color: #059669; font-size: 11px; font-weight: 600; margin-top: 5px;">
                            <i class="fas fa-clock"></i> Hours auto-set to: Mon-Fri 9 AM – 5 PM
                        </div>
                    </div>

                    <div style="text-align: center; margin-top:15px;">
                        <button class="btn btn-accent" onclick="parseVerify()">
                            <i class="fas fa-check-double"></i> Parse & Verify GMB Data
                        </button>
                    </div>

                    <!-- PARSED GMB DATA -->
                    <div id="parsedGMBArea" style="display:none;">
                        <div class="gmb-parsed">
                            <h4 style="color: var(--gold-dark); margin-bottom:15px; display:flex; align-items:center; gap:8px;">
                                <i class="fas fa-check-circle"></i> GMB Data Verified
                            </h4>
                            
                            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
                                <div>
                                    <div class="gmb-field">
                                        <div class="gmb-field-label">Business</div>
                                        <div class="gmb-field-value" id="parsed-name">—</div>
                                    </div>
                                    <div class="gmb-field">
                                        <div class="gmb-field-label">Category</div>
                                        <div class="gmb-field-value" id="parsed-category">—</div>
                                    </div>
                                </div>
                                <div>
                                    <div class="gmb-field">
                                        <div class="gmb-field-label">Phone</div>
                                        <div class="gmb-field-value" id="parsed-phone">—</div>
                                    </div>
                                    <div class="gmb-field">
                                        <div class="gmb-field-label">Website</div>
                                        <div class="gmb-field-value" id="parsed-website">—</div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- SERVICES - Full Width -->
                            <div style="margin-top:12px; padding-top:12px; border-top:1px solid var(--border-light);">
                                <div class="gmb-field" style="grid-template-columns: 80px 1fr;">
                                    <div class="gmb-field-label">Services</div>
                                    <div class="gmb-field-value" id="parsed-services" style="font-size:11px; line-height:1.5;">—</div>
                                </div>
                            </div>
                            
                            <!-- ADDRESS SECTION -->
                            <div style="margin-top:12px; padding-top:12px; border-top:1px solid var(--border-light);">
                                <div class="gmb-field">
                                    <div class="gmb-field-label">Street</div>
                                    <div class="gmb-field-value" id="parsed-address">—</div>
                                </div>
                                <div class="gmb-field">
                                    <div class="gmb-field-label">City, State</div>
                                    <div class="gmb-field-value" id="parsed-citystate">—</div>
                                </div>
                                <div class="gmb-field">
                                    <div class="gmb-field-label">Full Address</div>
                                    <div class="gmb-field-value" id="parsed-fulladdress">—</div>
                                </div>
                            </div>
                            
                            <!-- HOURS SECTION -->
                            <div style="margin-top:12px; padding-top:12px; border-top:1px solid var(--border-light);">
                                <div class="gmb-field">
                                    <div class="gmb-field-label">Hours</div>
                                    <div class="gmb-field-value" id="parsed-hours" style="white-space:pre-wrap;">—</div>
                                </div>
                            </div>
                            
                            <!-- Copy All GMB Data Button -->
                            <div style="margin-top:15px; text-align:center;">
                                <button class="btn btn-ghost" onclick="copyParsedGMB()">
                                    <i class="fas fa-copy"></i> Copy All Parsed GMB Data
                                </button>
                            </div>
                        </div>

                        <!-- CID VERIFICATION -->
                        <div class="cid-box">
                            <h4 style="color:#92400e; margin-bottom:5px;">
                                <i class="fas fa-fingerprint"></i> Schema CID Verification
                            </h4>
                            <div style="font-size:11px; color:#78716c; margin-bottom:10px;">
                                Extracted from 2nd hex value (true CID, not FID) → Converted to decimal
                            </div>
                            <div class="cid-display" id="cidDisplay">CID will appear here...</div>
                            <div style="display:flex; gap:10px; flex-wrap:wrap; margin-bottom:10px;">
                                <button class="btn btn-primary" onclick="testCID()">
                                    <i class="fas fa-external-link-alt"></i> Test CID Live
                                </button>
                                <button class="btn btn-accent" onclick="acceptCID()">
                                    <i class="fas fa-check"></i> CID Accepted ✓
                                </button>
                                <button class="btn btn-danger" onclick="rejectCID()">
                                    <i class="fas fa-times"></i> CID Wrong ✗
                                </button>
                            </div>
                            
                            <!-- Manual CID Input -->
                            <div style="margin-top:10px; padding-top:10px; border-top:1px dashed #fbbf24;">
                                <label style="font-size:11px; font-weight:700; color:#92400e;">MANUAL CID (decimal format):</label>
                                <div style="display:flex; gap:8px; margin-top:5px;">
                                    <input type="text" id="manualCID" placeholder="Paste decimal CID here (15-20 digits)..." style="flex:1; padding:8px; border:2px solid #fbbf24; border-radius:6px; font-family:'JetBrains Mono', monospace; font-size:11px;">
                                    <button class="btn btn-warning" onclick="useManualCID()">
                                        <i class="fas fa-save"></i> Use This CID
                                    </button>
                                </div>
                            </div>
                            
                            <div id="cidStatus" style="margin-top:10px; font-weight:700;"></div>
                        </div>

                        <!-- HUB+SPOKE INTERNAL LINKING -->
                        <div class="data-box" style="margin-top:15px; border-left: 3px solid var(--gold); background: var(--cream);">
                            <h4 style="color: var(--gold-dark); margin-bottom:10px; display:flex; align-items:center; gap:8px; font-size:14px;">
                                <i class="fas fa-sitemap"></i> Hub+Spoke Internal Linking
                            </h4>
                            <p style="font-size:11px; color:var(--text-secondary); margin-bottom:10px;">
                                Paste the city's Internal Linking Reference for 3-4 links per page in rows 4+.
                            </p>
                            <textarea id="hubSpokeHandoff" style="width:100%; height:100px; padding:10px; border:1px solid var(--border-light); border-radius:6px; font-family:'Inter',sans-serif; font-size:12px; background:var(--white);" placeholder="Paste the complete Hub+Spoke handoff here... (Tier 1-5 pages, local context, linking rules)"></textarea>
                            <button class="btn btn-accent" style="width:100%; margin-top:10px;" onclick="parseHubSpoke()">
                                <i class="fas fa-project-diagram"></i> Load Hub+Spoke Strategy
                            </button>
                            
                            <!-- PARSED HUB+SPOKE DATA -->
                            <div id="parsedHubSpokeArea" style="display:none; margin-top:12px;">
                                <div style="background: var(--white); border: 1px solid var(--border-light); border-left: 3px solid var(--gold); border-radius: 6px; padding: 12px;">
                                    <div style="display:flex; align-items:center; gap:6px; margin-bottom:10px; color:var(--gold-dark); font-weight:600; font-size:13px;">
                                        <i class="fas fa-check-circle"></i> Strategy Loaded
                                    </div>
                                    
                                    <div style="display:grid; grid-template-columns: 1fr 1fr; gap:6px; font-size:11px;">
                                        <div><span style="color:var(--gold-dark); font-weight:600;">City:</span> <span id="hubspoke-city">—</span></div>
                                        <div><span style="color:var(--gold-dark); font-weight:600;">Total:</span> <span id="hubspoke-total">—</span></div>
                                        <div><span style="color:var(--gold-dark); font-weight:600;">Tier 1:</span> <span id="hubspoke-tier1">—</span></div>
                                        <div><span style="color:var(--gold-dark); font-weight:600;">T2-5:</span> <span id="hubspoke-tiers">—</span></div>
                                    </div>
                                    
                                    <div style="margin-top:8px; padding-top:8px; border-top:1px solid var(--border-light); font-size:11px;">
                                        <span style="color:var(--gold-dark); font-weight:600;">Hub:</span>
                                        <span id="hubspoke-hubpage" style="font-family:'JetBrains Mono',monospace;">—</span>
                                    </div>

                                    <div style="margin-top:10px; padding:8px; background:rgba(201,169,98,0.15); border-radius:4px; font-size:10px; color:var(--gold-dark); font-weight:500;">
                                        ✓ Active — Linking data injected into Build + SEO prompts
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="verifyFail" class="warning-box" style="display:none;">
                        <strong>⚠️ Issue Detected:</strong> Please verify data manually.
                    </div>
                </div>
            </div>
        </div>

        <!-- PHASES -->
        <div id="phases">

            <!-- PHASE 1: BUILD IN CLAUDE -->
            <div class="card phase" id="phase1">
                <div class="phase-header" onclick="togglePhase('phase1')">
                    <div class="phase-title"><span class="phase-num">1</span> Build in Claude</div>
                    <div class="phase-time">15 min</div>
                </div>
                <div class="phase-content">
                    
                    <!-- SIDE BY SIDE LAUNCHER -->
                    <div class="side-by-side-box">
                        <div class="side-by-side-header">
                            <i class="fas fa-columns"></i>
                            OPEN SIDE BY SIDE TABS
                        </div>
                        <div class="side-by-side-sub">(to follow along together)</div>
                        <a href="https://claude.ai/project/019afe23-9854-71e3-896c-4a652a608017" target="_blank" class="side-by-side-btn" style="flex-direction:column; gap:4px;">
                            <span style="display:flex; align-items:center; gap:10px;"><i class="fas fa-brain"></i> Open Claude Project</span>
                            <span style="color:#ef4444; font-size:11px; font-weight:700;">(USE SONNET 4.5)</span>
                        </a>
                        <div class="side-by-side-tip">
                            Drag windows side-by-side for easy workflow
                        </div>
                        <input type="checkbox" id="p1-0" onchange="updateProgress()" style="position:absolute; top:15px; right:15px; width:22px; height:22px;">
                    </div>

                    <style>
                        .side-by-side-box {
                            position: relative;
                            background: linear-gradient(135deg, var(--navy) 0%, var(--navy-dark) 100%);
                            border-radius: 12px;
                            padding: 25px;
                            text-align: center;
                            margin-bottom: 15px;
                            border: 1px solid var(--gold);
                        }
                        .side-by-side-header {
                            font-size: 20px;
                            font-weight: 600;
                            color: white;
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            gap: 12px;
                        }
                        .side-by-side-sub {
                            font-size: 13px;
                            color: rgba(255,255,255,0.7);
                            margin-top: 5px;
                        }
                        .side-by-side-btn {
                            display: inline-flex;
                            align-items: center;
                            gap: 10px;
                            padding: 12px 24px;
                            background: var(--gold);
                            color: var(--white);
                            font-weight: 600;
                            font-size: 14px;
                            border-radius: 6px;
                            text-decoration: none;
                            margin-top: 15px;
                            transition: all 0.2s;
                            box-shadow: 0 4px 15px rgba(201,169,98,0.3);
                        }
                        .side-by-side-btn:hover {
                            transform: translateY(-2px);
                            box-shadow: 0 6px 20px rgba(201,169,98,0.4);
                            background: var(--gold-dark);
                        }
                        .side-by-side-tip {
                            margin-top: 12px;
                            font-size: 11px;
                            color: rgba(255,255,255,0.5);
                        }
                    </style>

                    <div class="step">
                        <input type="checkbox" id="p1-1" onchange="updateProgress()">
                        <div>
                            <div class="step-label">Start New Chat & Run Introduction</div>
                            <div class="step-sub">This names the chat and sets context</div>
                            <button class="btn btn-primary" style="margin-top:8px;" onclick="copyPrompt('intro')">
                                <i class="fas fa-play"></i> Copy Introduction Prompt
                            </button>
                            <div style="font-size:12px; color:#64748b; margin-top:5px;">
                                Page Name: <strong id="displayPageName">—</strong>
                            </div>
                        </div>
                    </div>

                    <!-- EXECUTE BOX -->
                    <div class="data-box" style="border-color: var(--primary); margin-top:15px;">
                        <h4 style="color:var(--primary); margin-bottom:10px;">🚀 Execute Page Build</h4>
                        <div style="font-size:12px; margin-bottom:15px; line-height:1.8; color:#475569;">
                            <strong>ORDER OF OPERATIONS:</strong><br>
                            1. Paste prompt in Claude chat<br>
                            2. Wait for LLM to read all uploaded documents<br>
                            3. LLM builds full HTML page with all sections<br>
                            4. Type "Approved" at each gate check when prompted
                        </div>
                        <div style="font-size:11px; margin-bottom:12px; padding:10px; background:#f1f5f9; border-radius:6px; color:#64748b;">
                            <strong>PROMPT INCLUDES:</strong> Target URL • Niche • Verified CID • GMB Data (Name, Address, Phone, Hours) • Forced execution instructions
                        </div>
                        <button class="btn btn-accent" style="width:100%;" onclick="copyPrompt('build')">
                            <i class="fas fa-terminal"></i> Copy Full Execution Prompt
                        </button>
                        
                        <div style="margin-top:15px; padding-top:15px; border-top:1px dashed #cbd5e1;">
                            <div style="color: #ef4444; font-size: 12px; font-weight: 600; margin-bottom: 10px;">
                                <i class="fas fa-arrow-down"></i> UPLOAD THESE FILES + PASTE PROMPT TO CLAUDE
                            </div>
                            <div class="quick-links">
                                <a href="https://docs.google.com/spreadsheets/d/1-5lrWau5auZLLK1TVljhiAUhPUvrzzQDx13S8Xj2Az4/edit?usp=sharing" target="_blank" class="quick-link">
                                    <i class="fas fa-table"></i> SEO Data 2026
                                </a>
                                <a href="https://docs.google.com/document/d/17n1jAFb5ghSCM9H6GOoVDoQqOG7Vf9Qmi0KCFe9X5Gw/edit?usp=sharing" target="_blank" class="quick-link">
                                    <i class="fas fa-file-alt"></i> Page Builder
                                </a>
                                <a href="https://docs.google.com/document/d/1vf4Hsk8QAdApstLghPlQAOJWylZ7C_zNz5rcpUs9ojQ/edit?usp=sharing" target="_blank" class="quick-link">
                                    <i class="fas fa-palette"></i> Master Design
                                </a>
                            </div>
                            <div class="step-sub" style="margin-top:10px;">Optional/Reference:</div>
                            <div class="quick-links">
                                <a href="https://docs.google.com/document/d/1IDlUOM-q8BUsP7C34nw68Jaqdy-Vh2pJ4HZVGldGBfg/edit?usp=sharing" target="_blank" class="quick-link secondary">
                                    <i class="fas fa-book"></i> Guides Design
                                </a>
                                <a href="https://docs.google.com/document/d/1VK-havAC03ZLgyrGPvc4S_FODGz0M4i6UajAq5UwLiM/edit?usp=sharing" target="_blank" class="quick-link secondary">
                                    <i class="fas fa-star"></i> New Design
                                </a>
                                <a href="https://docs.google.com/document/d/1SEw8RElqBNyyWG-0O8LOgpI5qs8l2nIjqHk0dp66nwE/edit?usp=sharing" target="_blank" class="quick-link secondary">
                                    <i class="fas fa-sitemap"></i> Hub+Spoke
                                </a>
                            </div>
                        </div>
                    </div>

                    <div class="step">
                        <input type="checkbox" id="p1-1b" onchange="updateProgress()">
                        <div>
                            <div class="step-label">Verify Hub+Spoke Internal Linking</div>
                            <div class="step-sub">Confirms contextual links + Related Services section</div>
                            <button class="btn" style="margin-top:8px; background: linear-gradient(135deg, #f97316 0%, #ea580c 100%); color:white;" onclick="copyPrompt('verify-hubspoke')">
                                <i class="fas fa-sitemap"></i> Verify Hub+Spoke Prompt
                            </button>
                        </div>
                    </div>

                    <div class="step">
                        <input type="checkbox" id="p1-2" onchange="updateProgress()">
                        <div class="step-label">Monitor Gate Checks (Type "Approved" when prompted)</div>
                    </div>
                </div>
            </div>

            <!-- PHASE 2: VERIFY DESIGN -->
            <div class="card phase" id="phase2">
                <div class="phase-header" onclick="togglePhase('phase2')">
                    <div class="phase-title"><span class="phase-num">2</span> Verify Design</div>
                    <div class="phase-time">5 min</div>
                </div>
                <div class="phase-content">
                    <div class="step">
                        <input type="checkbox" id="p2-1" onchange="updateProgress()">
                        <div class="step-label">Hero Section: City name in H1? Form on Right side?</div>
                    </div>
                    <div class="step">
                        <input type="checkbox" id="p2-2" onchange="updateProgress()">
                        <div class="step-label">Footer: Address matches GMB exactly?</div>
                    </div>
                    <div class="step">
                        <input type="checkbox" id="p2-3" onchange="updateProgress()">
                        <div class="step-label">Mobile Check: Images don't squeeze text?</div>
                    </div>
                    <div class="step">
                        <input type="checkbox" id="p2-4" onchange="updateProgress()">
                        <div>
                            <div class="step-label">Force Rebuild (if needed)</div>
                            <div class="step-sub">Describe the issue below:</div>
                            <textarea id="rebuildIssue" class="rebuild-input" placeholder="Example: Mobile view has images squeezing text in hero section. OR: LLM ignored Design Bible and made up its own layout."></textarea>
                            <button class="btn btn-danger" style="margin-top:5px;" onclick="copyPrompt('rebuild')">
                                <i class="fas fa-redo"></i> Generate Rebuild Prompt
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- PHASE 3: VERIFY LINKS -->
            <div class="card phase" id="phase3">
                <div class="phase-header" onclick="togglePhase('phase3')">
                    <div class="phase-title"><span class="phase-num">3</span> Verify All Links</div>
                    <div class="phase-time">2 min</div>
                </div>
                <div class="phase-content">
                    <div class="step">
                        <input type="checkbox" id="p3-1" onchange="updateProgress()">
                        <div>
                            <div class="step-label">Run Link Verification Audit</div>
                            <div class="step-sub">Checks emails, contact links, and catches LLM-invented URLs</div>
                            <button class="btn" style="margin-top:8px; background: linear-gradient(135deg, #f97316 0%, #ea580c 100%); color:white;" onclick="copyPrompt('verify-links')">
                                <i class="fas fa-link"></i> Copy Link Verification Prompt
                            </button>
                        </div>
                    </div>
                    
                    <div class="step">
                        <input type="checkbox" id="p3-2" onchange="updateProgress()">
                        <div class="step-label">✅ All Links Verified</div>
                    </div>
                </div>
            </div>

            <!-- PHASE 4: SEO AUDIT -->
            <div class="card phase" id="phase4">
                <div class="phase-header" onclick="togglePhase('phase4')">
                    <div class="phase-title"><span class="phase-num">4</span> SEO Audit</div>
                    <div class="phase-time">5 min</div>
                </div>
                <div class="phase-content">
                    <div class="step">
                        <input type="checkbox" id="p4-1" onchange="updateProgress()">
                        <div>
                            <div class="step-label">Upload SEO Audit File & Run Audit</div>
                            <div class="step-sub">This will STRIP Schema (rebuilt in Phase 5)</div>
                            <button class="btn btn-accent" style="margin-top:5px;" onclick="copyPrompt('seo')">
                                <i class="fas fa-search"></i> Copy SEO Audit Prompt
                            </button>
                            
                            <div style="margin-top:12px;">
                                <div style="color: #ef4444; font-size: 11px; font-weight: 600; margin-bottom: 6px;">
                                    <i class="fas fa-arrow-down"></i> UPLOAD FILE + PASTE PROMPT
                                </div>
                                <a href="https://docs.google.com/document/d/15CTAiHwxsHyAxO_EMlOpHEIic2Z89ftbpKGLUDvDHJQ/edit?usp=sharing" target="_blank" class="quick-link">
                                    <i class="fas fa-file-alt"></i> SEO Audit Doc
                                </a>
                            </div>
                        </div>
                    </div>
                    
                    <!-- SEO VERIFICATION -->
                    <div class="step">
                        <input type="checkbox" id="p4-2" onchange="updateProgress()">
                        <div>
                            <div class="step-label">Verify SEO Audit Completion</div>
                            <div class="step-sub">Confirms audit steps followed + checks modern SEO standards</div>
                            <button class="btn" style="margin-top:8px; background: linear-gradient(135deg, #f97316 0%, #ea580c 100%); color:white;" onclick="copyPrompt('seo-verify')">
                                <i class="fas fa-clipboard-check"></i> Copy SEO Verification Prompt
                            </button>
                        </div>
                    </div>
                    
                    <div class="step">
                        <input type="checkbox" id="p4-3" onchange="updateProgress()">
                        <div class="step-label">✅ SEO Verification PASSED — Ready for Schema</div>
                    </div>
                </div>
            </div>

            <!-- PHASE 5: SCHEMA GENERATOR -->
            <div class="card phase" id="phase5" style="border-left: 4px solid var(--accent);">
                <div class="phase-header" onclick="togglePhase('phase5')">
                    <div class="phase-title"><span class="phase-num" style="background:var(--accent);">5</span> Schema Generator</div>
                    <div class="phase-time">5 min</div>
                </div>
                <div class="phase-content">
                    <div class="warning-box" style="margin-bottom:15px;">
                        <i class="fas fa-exclamation-triangle"></i> <strong>CRITICAL:</strong> Phase 4 stripped the schema. Rebuild it now.
                    </div>

                    <!-- CID QUICK ACCESS -->
                    <div class="data-box" style="border-color: var(--accent); margin-bottom:15px; background: linear-gradient(135deg, #ecfdf5 0%, #d1fae5 100%);">
                        <h4 style="font-size:13px; margin-bottom:10px; color:var(--accent);">
                            <i class="fas fa-fingerprint"></i> CID for Schema
                        </h4>
                        <div style="display:flex; gap:10px; align-items:center; flex-wrap:wrap;">
                            <code id="schemaCID" style="flex:1; padding:10px; background:#fff; border:2px solid var(--accent); border-radius:6px; font-family:'JetBrains Mono', monospace; font-size:14px; min-width:200px;">—</code>
                            <button class="btn btn-accent" onclick="copySchemaCID()" style="white-space:nowrap;">
                                <i class="fas fa-copy"></i> Copy CID
                            </button>
                        </div>
                        <a id="schemaCIDLink" href="#" target="_blank" style="display:inline-block; margin-top:10px; font-size:12px; color:var(--accent);">
                            <i class="fas fa-external-link-alt"></i> Open in Google Maps
                        </a>
                    </div>

                    <div class="step">
                        <input type="checkbox" id="p5-1" onchange="updateProgress()">
                        <div>
                            <div class="step-label">Upload Schema Generator & Run</div>
                            <button class="btn btn-accent" style="margin-top:5px;" onclick="copyPrompt('schema')">
                                <i class="fas fa-code"></i> Copy Schema Prompt
                            </button>
                            <div style="margin-top:8px; font-size:11px; color:#f97316;">
                                <i class="fas fa-exclamation-circle"></i> Do NOT include aggregateRating/reviews in schema
                            </div>
                            
                            <div style="margin-top:12px;">
                                <div style="color: #ef4444; font-size: 11px; font-weight: 600; margin-bottom: 6px;">
                                    <i class="fas fa-arrow-down"></i> UPLOAD FILE + PASTE PROMPT
                                </div>
                                <a href="https://docs.google.com/document/d/1labL6l4YBkop02jZhGEujg_OfAgKYElCwQ2hctGIXI8/edit?usp=sharing" target="_blank" class="quick-link">
                                    <i class="fas fa-file-code"></i> Schema Generator Doc
                                </a>
                            </div>
                        </div>
                    </div>

                    <!-- SCHEMA VERIFICATION AUDIT -->
                    <div class="step" style="margin-top:15px;">
                        <input type="checkbox" id="p5-verify" onchange="updateProgress()">
                        <div>
                            <div class="step-label">Run Schema Verification Audit</div>
                            <div class="step-sub">Web search for current best practices</div>
                            <button class="btn" style="margin-top:8px; background: linear-gradient(135deg, #f97316 0%, #ea580c 100%); color:white;" onclick="copyPrompt('schema-verify')">
                                <i class="fas fa-search"></i> Copy Schema Verify Prompt
                            </button>
                        </div>
                    </div>

                    <!-- SCHEMA VALIDATOR -->
                    <div class="data-box" style="margin-top:20px; border-color: var(--accent);">
                        <h4 style="font-size:14px; margin-bottom:8px; color:var(--accent);">
                            <i class="fas fa-shield-alt"></i> Schema Validator
                        </h4>
                        <p style="font-size:12px; color:#64748b; margin-bottom:10px;">
                            Paste Schema code to verify CID, city, and structure.
                        </p>
                        <textarea id="schemaPaste" class="code-check-area" placeholder="Paste your JSON-LD schema code here..."></textarea>
                        <button class="btn btn-primary" style="width:100%; margin-top:10px;" onclick="validateSchema()">
                            <i class="fas fa-check-circle"></i> Validate Schema
                        </button>
                        <div id="schemaResults"></div>
                    </div>

                    <div class="step" style="margin-top:20px;">
                        <input type="checkbox" id="p5-2" onchange="updateProgress()">
                        <div class="step-label">Verify: Schema has <span style="color:#ef4444; font-weight:600;">&lt;script&gt;</span> at TOP and <span style="color:#ef4444; font-weight:600;">&lt;/script&gt;</span> at BOTTOM</div>
                    </div>
                </div>
            </div>

            <!-- PHASE 6: JOOMLA PART 1 - META -->
            <div class="card phase" id="phase6">
                <div class="phase-header" onclick="togglePhase('phase6')">
                    <div class="phase-title"><span class="phase-num">6</span> Joomla Part 1: Meta Setup</div>
                    <div class="phase-time">3 min</div>
                </div>
                <div class="phase-content">
                    <div class="part-header">
                        <i class="fas fa-cog"></i> PART 1: Template & Meta Data
                    </div>

                    <div class="quick-links" style="margin-bottom:15px;">
                        <a href="https://www.stselectronicrecyclinginc.com/administrator/index.php?option=com_menus&view=items&menutype=mainmenu" target="_blank" class="quick-link">
                            <i class="fas fa-bars"></i> Main Menu
                        </a>
                    </div>

                    <div class="step">
                        <input type="checkbox" id="p6-1" onchange="updateProgress()">
                        <div class="step-label">Open Main Menu → Search for City → Verify ALIAS</div>
                    </div>

                    <div class="step">
                        <input type="checkbox" id="p6-2" onchange="updateProgress()">
                        <div>
                            <div class="step-label">Click on page → Details tab → Select Template</div>
                            <div class="instruction-box">
                                Template: <code>Clean Top 2026</code>
                            </div>
                        </div>
                    </div>

                    <div class="step">
                        <input type="checkbox" id="p6-3" onchange="updateProgress()">
                        <div>
                            <div class="step-label">Options tab → Set "Show Title" to HIDE</div>
                        </div>
                    </div>

                    <div class="step">
                        <input type="checkbox" id="p6-4" onchange="updateProgress()">
                        <div>
                            <div class="step-label">Get Meta Data from Claude</div>
                            <button class="btn btn-ghost" style="margin-top:5px;" onclick="copyPrompt('meta')">
                                <i class="fas fa-tags"></i> Copy Meta Prompt
                            </button>
                        </div>
                    </div>

                    <div class="step">
                        <input type="checkbox" id="p6-5" onchange="updateProgress()">
                        <div class="step-label">Page Title tab → Add Page Title</div>
                    </div>

                    <div class="step">
                        <input type="checkbox" id="p6-6" onchange="updateProgress()">
                        <div class="step-label">Metadata tab → Add Meta Description & Keywords → SAVE</div>
                    </div>
                </div>
            </div>

            <!-- PHASE 7: PRE-UPLOAD LINK AUDIT -->
            <div class="card phase" id="phase7">
                <div class="phase-header" onclick="togglePhase('phase7')">
                    <div class="phase-title"><span class="phase-num">7</span> Pre-Upload Link Audit</div>
                    <div class="phase-time">2 min</div>
                </div>
                <div class="phase-content">
                    <div class="warning-box" style="margin-bottom:15px;">
                        <i class="fas fa-exclamation-triangle"></i> <strong>LAST CHECK:</strong> Verify all links before uploading to Joomla
                    </div>
                    <div class="step">
                        <input type="checkbox" id="p7-1" onchange="updateProgress()">
                        <div>
                            <div class="step-label">Run Final Link Audit Before Upload</div>
                            <div class="step-sub">Catches any issues from SEO/Schema edits</div>
                            <button class="btn" style="margin-top:8px; background: linear-gradient(135deg, #f97316 0%, #ea580c 100%); color:white;" onclick="copyPrompt('verify-links')">
                                <i class="fas fa-link"></i> Copy Link Verification Prompt
                            </button>
                        </div>
                    </div>
                    <div class="step">
                        <input type="checkbox" id="p7-2" onchange="updateProgress()">
                        <div class="step-label">✅ All Links Verified — Ready for Joomla</div>
                    </div>
                </div>
            </div>

            <!-- PHASE 8: JOOMLA PART 2 - HTML & SCHEMA -->
            <div class="card phase" id="phase8">
                <div class="phase-header" onclick="togglePhase('phase8')">
                    <div class="phase-title"><span class="phase-num">8</span> Joomla Part 2: HTML & Schema</div>
                    <div class="phase-time">5 min</div>
                </div>
                <div class="phase-content">
                    <div class="part-header">
                        <i class="fas fa-code"></i> PART 2: Content & Schema
                    </div>

                    <div class="step">
                        <input type="checkbox" id="p8-1" onchange="updateProgress()">
                        <div class="step-label">Back to Details → Click "Edit Article"</div>
                    </div>

                    <div class="step">
                        <input type="checkbox" id="p8-2" onchange="updateProgress()">
                        <div class="step-label">Delete old HTML → Paste new HTML (Code View)</div>
                    </div>

                    <div class="step">
                        <input type="checkbox" id="p8-3" onchange="updateProgress()">
                        <div class="step-label">Verify: HTML ends with &lt;/body&gt; tag</div>
                    </div>

                    <div class="step">
                        <input type="checkbox" id="p8-4" onchange="updateProgress()">
                        <div class="step-label">Google Structured Data tab → Add Custom Code</div>
                    </div>

                    <div class="step">
                        <input type="checkbox" id="p8-5" onchange="updateProgress()">
                        <div class="step-label">Paste Schema → Verify <span style="color:#ef4444; font-weight:600;">script tags</span> at top/bottom</div>
                    </div>

                    <div class="step">
                        <input type="checkbox" id="p8-6" onchange="updateProgress()">
                        <div class="step-label">Save & Close</div>
                    </div>
                </div>
            </div>

            <!-- PHASE 9: VERIFY & CACHE -->
            <div class="card phase" id="phase9">
                <div class="phase-header" onclick="togglePhase('phase9')">
                    <div class="phase-title"><span class="phase-num">9</span> Part 3: Cache & Verify</div>
                    <div class="phase-time">3 min</div>
                </div>
                <div class="phase-content">
                    <div class="part-header">
                        <i class="fas fa-broom"></i> PART 3: Clear Cache & Final Check
                    </div>

                    <div class="quick-links" style="margin-bottom:15px;">
                        <a href="https://www.stselectronicrecyclinginc.com/administrator/index.php?option=com_cache" target="_blank" class="quick-link">
                            <i class="fas fa-broom"></i> Clear Cache
                        </a>
                    </div>

                    <div class="step">
                        <input type="checkbox" id="p9-1" onchange="updateProgress()">
                        <div class="step-label">Open Cache → Click "Delete All"</div>
                    </div>

                    <div class="step">
                        <input type="checkbox" id="p9-2" onchange="updateProgress()">
                        <div>
                            <div class="step-label">Open Live Page & Hard Refresh</div>
                            <div class="step-sub">Ctrl+Shift+R (Windows) or Cmd+Shift+R (Mac)</div>
                            <button class="btn btn-primary" style="margin-top:5px;" onclick="openLivePage()">
                                <i class="fas fa-external-link-alt"></i> Open Live Page
                            </button>
                        </div>
                    </div>

                    <div class="step">
                        <input type="checkbox" id="p9-3" onchange="updateProgress()">
                        <div class="step-label">Visual Check: Page looks correct</div>
                    </div>

                    <div class="step">
                        <input type="checkbox" id="p9-4" onchange="updateProgress()">
                        <div class="step-label">Mobile Check: Test on phone or responsive mode</div>
                    </div>

                    <div class="step">
                        <input type="checkbox" id="p9-5" onchange="updateProgress()">
                        <div class="step-label">Verify: GMB data in footer matches</div>
                    </div>
                </div>
            </div>

        </div>
        
        <!-- PHASE 9: COMPLETION -->
        <div class="card" style="text-align: center; padding: 40px;">
            <h2 style="color:var(--accent); margin-bottom: 20px;">🎉 Part 4: Completion Report</h2>
            <p style="color:#64748b; margin-bottom:20px;">All phases finished. Generate your completion report.</p>
            <button class="btn btn-accent" onclick="generateReport()" style="font-size:16px; padding:12px 30px;">
                <i class="fas fa-clipboard-check"></i> Generate Report
            </button>
        </div>

    </div>

    <div id="toast" class="toast">
        <i class="fas fa-check-circle"></i>
        <span id="toastMsg">Action Successful</span>
    </div>

    <script>
        // === STATE ===
        let appState = {
            startTime: null,
            pageURL: '',
            vaName: '',
            gmbURL: '',
            gmbData: '',
            hubSpokeHandoff: '',
            parsedHubSpoke: {},
            city: '',
            state: '',
            niche: 'Electronic Recycling',
            cid: '',
            cidAccepted: false,
            pageName: '',
            parsedGMB: {},
            checks: {}
        };

        // === BOOT SEQUENCE ===
        const bootMessages = [
            'Initializing System',
            'Loading Modules',
            'Ready'
        ];

        function runBootSequence() {
            const bootText = document.getElementById('bootText');
            const bootOverlay = document.getElementById('bootOverlay');
            let messageIndex = 0;

            function showNextMessage() {
                if (messageIndex < bootMessages.length) {
                    const div = document.createElement('div');
                    div.textContent = bootMessages[messageIndex];
                    div.style.animationDelay = '0s';
                    bootText.appendChild(div);
                    messageIndex++;
                    setTimeout(showNextMessage, 400);
                } else {
                    setTimeout(() => {
                        bootOverlay.classList.add('hidden');
                    }, 800);
                }
            }
            setTimeout(showNextMessage, 300);
        }

        // === STATUS BAR CLOCK ===
        function updateStatusClock() {
            const now = new Date();
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            const seconds = String(now.getSeconds()).padStart(2, '0');
            document.getElementById('statusClock').textContent = `${hours}:${minutes}:${seconds}`;
        }

        // === PHASE COMPLETION DETECTION ===
        function checkPhaseCompletion() {
            const phases = document.querySelectorAll('.phase');
            let currentActivePhase = 1;
            
            phases.forEach((phase, index) => {
                const phaseNum = index + 1;
                const checkboxes = phase.querySelectorAll('input[type="checkbox"]');
                const checkedBoxes = phase.querySelectorAll('input[type="checkbox"]:checked');
                
                if (checkboxes.length > 0 && checkboxes.length === checkedBoxes.length) {
                    // Phase complete!
                    if (!phase.classList.contains('phase-complete')) {
                        phase.classList.add('phase-complete');
                        
                        // Trigger next phase unlock
                        const nextPhase = phases[index + 1];
                        if (nextPhase && !nextPhase.classList.contains('active')) {
                            setTimeout(() => {
                                nextPhase.classList.add('phase-unlocking');
                                nextPhase.classList.add('active');
                                showToast(`✓ Phase ${phaseNum} Complete → Phase ${phaseNum + 1} Ready`);
                                
                                // Scroll to next phase
                                setTimeout(() => {
                                    nextPhase.scrollIntoView({ behavior: 'smooth', block: 'center' });
                                    nextPhase.classList.remove('phase-unlocking');
                                }, 300);
                            }, 400);
                        }
                    }
                    currentActivePhase = phaseNum + 1;
                } else {
                    phase.classList.remove('phase-complete');
                }
            });
            
            // Update status bar phase indicator
            const phaseNumEl = document.getElementById('currentPhaseNum');
            if (phaseNumEl) {
                phaseNumEl.textContent = Math.min(currentActivePhase, 9);
            }
            
            // Check for 100% completion
            checkForCompletion();
        }

        window.onload = function() {
            // Run boot sequence
            runBootSequence();
            
            // Start status clock
            updateStatusClock();
            setInterval(updateStatusClock, 1000);
            
            // Load saved state
            loadState();
            setInterval(updateTimer, 1000);
            
            // Initial phase check
            setTimeout(checkPhaseCompletion, 100);
        };

        // === 100% COMPLETION CELEBRATION ===
        let completionTriggered = false;

        function checkForCompletion() {
            const total = document.querySelectorAll('#phases input[type="checkbox"]').length;
            const checked = document.querySelectorAll('#phases input[type="checkbox"]:checked').length;
            
            if (total > 0 && checked === total && !completionTriggered) {
                completionTriggered = true;
                setTimeout(triggerCompletion, 500);
            } else if (checked < total) {
                completionTriggered = false;
            }
        }

        function triggerCompletion() {
            const overlay = document.getElementById('completionOverlay');
            const pageEl = document.getElementById('completionPage');
            const timeEl = document.getElementById('completionTime');
            
            if (overlay) {
                // Set stats
                if (pageEl) pageEl.textContent = appState.pageName || 'Landing Page';
                if (timeEl) {
                    const diff = appState.startTime ? Math.floor((Date.now() - appState.startTime) / 1000) : 0;
                    const mins = Math.floor(diff / 60);
                    const secs = diff % 60;
                    timeEl.textContent = `${mins}:${secs.toString().padStart(2, '0')}`;
                }
                
                // Show overlay
                overlay.classList.add('active');
                
                // Trigger confetti
                createConfetti();
            }
        }

        function closeCompletion() {
            const overlay = document.getElementById('completionOverlay');
            if (overlay) {
                overlay.classList.remove('active');
            }
        }

        function createConfetti() {
            const colors = ['#c9a962', '#d4bc7d', '#1e3a5f', '#b8954d', '#2d4a6f', '#e8dcc8'];
            const overlay = document.getElementById('completionOverlay');
            
            for (let i = 0; i < 40; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = Math.random() * 100 + '%';
                confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.animationDelay = Math.random() * 2 + 's';
                confetti.style.animationDuration = (2.5 + Math.random() * 2) + 's';
                overlay.appendChild(confetti);
                
                setTimeout(() => confetti.classList.add('active'), 10);
                setTimeout(() => confetti.remove(), 5000);
            }
        }

        function saveState() {
            appState.vaName = document.getElementById('vaName').value;
            appState.pageURL = document.getElementById('pageURL').value;
            appState.gmbURL = document.getElementById('gmbURL').value;
            appState.gmbData = document.getElementById('gmbData').value;
            appState.hubSpokeHandoff = document.getElementById('hubSpokeHandoff').value;
            appState.city = document.getElementById('cityName').value;
            appState.state = document.getElementById('stateName').value;
            
            document.querySelectorAll('input[type="checkbox"]').forEach(cb => {
                appState.checks[cb.id] = cb.checked;
            });

            localStorage.setItem('stsTrackerV7', JSON.stringify(appState));
            updateProgressBar();
        }

        function loadState() {
            const saved = localStorage.getItem('stsTrackerV7');
            if(saved) {
                appState = JSON.parse(saved);
                document.getElementById('vaName').value = appState.vaName || '';
                document.getElementById('pageURL').value = appState.pageURL || '';
                document.getElementById('gmbURL').value = appState.gmbURL || '';
                document.getElementById('gmbData').value = appState.gmbData || '';
                document.getElementById('hubSpokeHandoff').value = appState.hubSpokeHandoff || '';
                document.getElementById('cityName').value = appState.city || '';
                document.getElementById('stateName').value = appState.state || '';
                
                if(appState.pageName) {
                    document.getElementById('displayPageName').textContent = appState.pageName;
                }

                for(const [id, checked] of Object.entries(appState.checks)) {
                    const el = document.getElementById(id);
                    if(el) {
                        el.checked = checked;
                        if(checked) el.closest('.step')?.classList.add('checked');
                    }
                }

                if(appState.city) {
                    document.getElementById('dataArea').style.display = 'block';
                }

                if(appState.parsedGMB && appState.parsedGMB.name) {
                    document.getElementById('parsedGMBArea').style.display = 'block';
                    displayParsedGMB();
                }

                // Restore Hub+Spoke display if loaded
                if(appState.parsedHubSpoke && appState.parsedHubSpoke.raw) {
                    const p = appState.parsedHubSpoke;
                    document.getElementById('hubspoke-city').textContent = p.city + (p.state ? ', ' + p.state : '');
                    document.getElementById('hubspoke-total').textContent = p.totalPages || 'Not specified';
                    document.getElementById('hubspoke-tier1').textContent = p.tier1Count + ' pages';
                    document.getElementById('hubspoke-tiers').textContent = 
                        `T2: ${p.tier2Count} | T3: ${p.tier3Count} | T4: ${p.tier4Count} | T5: ${p.tier5Count}`;
                    document.getElementById('hubspoke-hubpage').textContent = p.hubPage || 'Auto-detect from handoff';
                    document.getElementById('parsedHubSpokeArea').style.display = 'block';
                }

                if(appState.cid) {
                    document.getElementById('cidDisplay').textContent = appState.cid;
                    updateSchemaCIDDisplay();
                }

                if(appState.cidAccepted) {
                    document.getElementById('cidStatus').innerHTML = '<span style="color:#059669;">✓ CID ACCEPTED</span>';
                }
            }
            updateProgressBar();
        }

        function resetAll() {
            if(confirm("Are you sure? This will wipe all data.")) {
                // Clear localStorage first
                localStorage.removeItem('stsTrackerV7');
                
                // Manually clear all form fields
                document.getElementById('vaName').value = '';
                document.getElementById('pageURL').value = '';
                document.getElementById('gmbURL').value = '';
                document.getElementById('gmbData').value = '';
                document.getElementById('hubSpokeHandoff').value = '';
                document.getElementById('cityName').value = '';
                document.getElementById('stateName').value = '';
                document.getElementById('displayPageName').textContent = '—';
                document.getElementById('cidDisplay').textContent = 'CID will appear here...';
                document.getElementById('cidStatus').innerHTML = '';
                
                // Clear manual CID input
                const manualCID = document.getElementById('manualCID');
                if(manualCID) manualCID.value = '';
                
                // Clear parsed GMB fields
                document.getElementById('parsed-name').textContent = '—';
                document.getElementById('parsed-category').textContent = '—';
                document.getElementById('parsed-address').textContent = '—';
                document.getElementById('parsed-citystate').textContent = '—';
                document.getElementById('parsed-fulladdress').textContent = '—';
                document.getElementById('parsed-phone').textContent = '—';
                document.getElementById('parsed-website').textContent = '—';
                document.getElementById('parsed-hours').textContent = '—';
                document.getElementById('parsed-services').textContent = '—';
                
                // Hide dynamic areas
                document.getElementById('dataArea').style.display = 'none';
                document.getElementById('parsedGMBArea').style.display = 'none';
                document.getElementById('parsedHubSpokeArea').style.display = 'none';
                document.getElementById('verifyFail').style.display = 'none';
                
                // Clear Hub+Spoke parsed fields
                document.getElementById('hubspoke-city').textContent = '—';
                document.getElementById('hubspoke-total').textContent = '—';
                document.getElementById('hubspoke-tier1').textContent = '—';
                document.getElementById('hubspoke-tiers').textContent = '—';
                document.getElementById('hubspoke-hubpage').textContent = '—';
                
                // Clear all checkboxes
                document.querySelectorAll('input[type="checkbox"]').forEach(cb => {
                    cb.checked = false;
                    const step = cb.closest('.step');
                    if(step) step.classList.remove('checked');
                });
                
                // Clear schema validator
                const schemaPaste = document.getElementById('schemaPaste');
                if(schemaPaste) schemaPaste.value = '';
                const schemaResults = document.getElementById('schemaResults');
                if(schemaResults) schemaResults.innerHTML = '';
                
                // Clear schema CID display
                const schemaCID = document.getElementById('schemaCID');
                if(schemaCID) schemaCID.textContent = '—';
                const schemaCIDLink = document.getElementById('schemaCIDLink');
                if(schemaCIDLink) schemaCIDLink.style.display = 'none';
                
                // Clear rebuild issue
                const rebuildIssue = document.getElementById('rebuildIssue');
                if(rebuildIssue) rebuildIssue.value = '';
                
                // Reset progress
                document.getElementById('progressBar').style.width = '0%';
                document.getElementById('percentDisplay').textContent = '0%';
                document.getElementById('timerDisplay').textContent = '00:00';
                
                // Reset app state
                appState = {
                    startTime: null,
                    pageURL: '',
                    vaName: '',
                    gmbURL: '',
                    gmbData: '',
                    hubSpokeHandoff: '',
                    parsedHubSpoke: {},
                    city: '',
                    state: '',
                    niche: 'Electronic Recycling',
                    cid: '',
                    cidAccepted: false,
                    pageName: '',
                    parsedGMB: {},
                    checks: {}
                };
                
                // Collapse all phases
                document.querySelectorAll('.phase').forEach(phase => {
                    phase.classList.remove('active');
                });
                
                // Reset phase status display
                document.getElementById('currentPhaseNum').textContent = '1';
                
                showToast("System Reset Complete!");
            }
        }

        // === 300 LARGEST US METRO AREAS LOOKUP ===
        const cityLookup = {
            // Top 100
            'new-york': 'New York, NY',
            'los-angeles': 'Los Angeles, CA',
            'chicago': 'Chicago, IL',
            'houston': 'Houston, TX',
            'phoenix': 'Phoenix, AZ',
            'philadelphia': 'Philadelphia, PA',
            'san-antonio': 'San Antonio, TX',
            'san-diego': 'San Diego, CA',
            'dallas': 'Dallas, TX',
            'san-jose': 'San Jose, CA',
            'austin': 'Austin, TX',
            'jacksonville': 'Jacksonville, FL',
            'fort-worth': 'Fort Worth, TX',
            'columbus': 'Columbus, OH',
            'charlotte': 'Charlotte, NC',
            'san-francisco': 'San Francisco, CA',
            'indianapolis': 'Indianapolis, IN',
            'seattle': 'Seattle, WA',
            'denver': 'Denver, CO',
            'washington': 'Washington, DC',
            'boston': 'Boston, MA',
            'el-paso': 'El Paso, TX',
            'nashville': 'Nashville, TN',
            'detroit': 'Detroit, MI',
            'oklahoma-city': 'Oklahoma City, OK',
            'portland': 'Portland, OR',
            'las-vegas': 'Las Vegas, NV',
            'memphis': 'Memphis, TN',
            'louisville': 'Louisville, KY',
            'baltimore': 'Baltimore, MD',
            'milwaukee': 'Milwaukee, WI',
            'albuquerque': 'Albuquerque, NM',
            'tucson': 'Tucson, AZ',
            'fresno': 'Fresno, CA',
            'mesa': 'Mesa, AZ',
            'sacramento': 'Sacramento, CA',
            'atlanta': 'Atlanta, GA',
            'kansas-city': 'Kansas City, MO',
            'colorado-springs': 'Colorado Springs, CO',
            'miami': 'Miami, FL',
            'raleigh': 'Raleigh, NC',
            'omaha': 'Omaha, NE',
            'long-beach': 'Long Beach, CA',
            'virginia-beach': 'Virginia Beach, VA',
            'oakland': 'Oakland, CA',
            'minneapolis': 'Minneapolis, MN',
            'tulsa': 'Tulsa, OK',
            'tampa': 'Tampa, FL',
            'arlington': 'Arlington, TX',
            'new-orleans': 'New Orleans, LA',
            'wichita': 'Wichita, KS',
            'cleveland': 'Cleveland, OH',
            'bakersfield': 'Bakersfield, CA',
            'aurora': 'Aurora, CO',
            'anaheim': 'Anaheim, CA',
            'honolulu': 'Honolulu, HI',
            'santa-ana': 'Santa Ana, CA',
            'riverside': 'Riverside, CA',
            'corpus-christi': 'Corpus Christi, TX',
            'lexington': 'Lexington, KY',
            'stockton': 'Stockton, CA',
            'henderson': 'Henderson, NV',
            'saint-paul': 'Saint Paul, MN',
            'st-paul': 'Saint Paul, MN',
            'saint-louis': 'Saint Louis, MO',
            'st-louis': 'Saint Louis, MO',
            'cincinnati': 'Cincinnati, OH',
            'pittsburgh': 'Pittsburgh, PA',
            'greensboro': 'Greensboro, NC',
            'anchorage': 'Anchorage, AK',
            'plano': 'Plano, TX',
            'lincoln': 'Lincoln, NE',
            'orlando': 'Orlando, FL',
            'irvine': 'Irvine, CA',
            'newark': 'Newark, NJ',
            'toledo': 'Toledo, OH',
            'durham': 'Durham, NC',
            'chula-vista': 'Chula Vista, CA',
            'fort-wayne': 'Fort Wayne, IN',
            'jersey-city': 'Jersey City, NJ',
            'saint-petersburg': 'Saint Petersburg, FL',
            'st-petersburg': 'Saint Petersburg, FL',
            'laredo': 'Laredo, TX',
            'madison': 'Madison, WI',
            'chandler': 'Chandler, AZ',
            'buffalo': 'Buffalo, NY',
            'lubbock': 'Lubbock, TX',
            'scottsdale': 'Scottsdale, AZ',
            'reno': 'Reno, NV',
            'glendale': 'Glendale, AZ',
            'gilbert': 'Gilbert, AZ',
            'winston-salem': 'Winston-Salem, NC',
            'north-las-vegas': 'North Las Vegas, NV',
            'norfolk': 'Norfolk, VA',
            'chesapeake': 'Chesapeake, VA',
            'garland': 'Garland, TX',
            'irving': 'Irving, TX',
            'hialeah': 'Hialeah, FL',
            'fremont': 'Fremont, CA',
            'boise': 'Boise, ID',
            // 101-200
            'richmond': 'Richmond, VA',
            'baton-rouge': 'Baton Rouge, LA',
            'spokane': 'Spokane, WA',
            'des-moines': 'Des Moines, IA',
            'tacoma': 'Tacoma, WA',
            'san-bernardino': 'San Bernardino, CA',
            'modesto': 'Modesto, CA',
            'fontana': 'Fontana, CA',
            'santa-clarita': 'Santa Clarita, CA',
            'birmingham': 'Birmingham, AL',
            'oxnard': 'Oxnard, CA',
            'fayetteville': 'Fayetteville, NC',
            'moreno-valley': 'Moreno Valley, CA',
            'rochester': 'Rochester, NY',
            'glendale': 'Glendale, CA',
            'huntington-beach': 'Huntington Beach, CA',
            'salt-lake-city': 'Salt Lake City, UT',
            'grand-rapids': 'Grand Rapids, MI',
            'amarillo': 'Amarillo, TX',
            'yonkers': 'Yonkers, NY',
            'aurora': 'Aurora, IL',
            'montgomery': 'Montgomery, AL',
            'akron': 'Akron, OH',
            'little-rock': 'Little Rock, AR',
            'huntsville': 'Huntsville, AL',
            'augusta': 'Augusta, GA',
            'port-saint-lucie': 'Port Saint Lucie, FL',
            'port-st-lucie': 'Port Saint Lucie, FL',
            'grand-prairie': 'Grand Prairie, TX',
            'columbus': 'Columbus, GA',
            'tallahassee': 'Tallahassee, FL',
            'overland-park': 'Overland Park, KS',
            'tempe': 'Tempe, AZ',
            'mckinney': 'McKinney, TX',
            'mobile': 'Mobile, AL',
            'cape-coral': 'Cape Coral, FL',
            'shreveport': 'Shreveport, LA',
            'frisco': 'Frisco, TX',
            'knoxville': 'Knoxville, TN',
            'worcester': 'Worcester, MA',
            'brownsville': 'Brownsville, TX',
            'vancouver': 'Vancouver, WA',
            'fort-lauderdale': 'Fort Lauderdale, FL',
            'sioux-falls': 'Sioux Falls, SD',
            'ontario': 'Ontario, CA',
            'chattanooga': 'Chattanooga, TN',
            'providence': 'Providence, RI',
            'newport-news': 'Newport News, VA',
            'rancho-cucamonga': 'Rancho Cucamonga, CA',
            'santa-rosa': 'Santa Rosa, CA',
            'oceanside': 'Oceanside, CA',
            'salem': 'Salem, OR',
            'elk-grove': 'Elk Grove, CA',
            'garden-grove': 'Garden Grove, CA',
            'pembroke-pines': 'Pembroke Pines, FL',
            'peoria': 'Peoria, AZ',
            'eugene': 'Eugene, OR',
            'corona': 'Corona, CA',
            'cary': 'Cary, NC',
            'springfield': 'Springfield, MO',
            'fort-collins': 'Fort Collins, CO',
            'jackson': 'Jackson, MS',
            'alexandria': 'Alexandria, VA',
            'hayward': 'Hayward, CA',
            'clarksville': 'Clarksville, TN',
            'lakewood': 'Lakewood, CO',
            'lancaster': 'Lancaster, CA',
            'salinas': 'Salinas, CA',
            'palmdale': 'Palmdale, CA',
            'hollywood': 'Hollywood, FL',
            'springfield': 'Springfield, MA',
            'macon': 'Macon, GA',
            'kansas-city': 'Kansas City, KS',
            'sunnyvale': 'Sunnyvale, CA',
            'pomona': 'Pomona, CA',
            'killeen': 'Killeen, TX',
            'escondido': 'Escondido, CA',
            'pasadena': 'Pasadena, TX',
            'naperville': 'Naperville, IL',
            'bellevue': 'Bellevue, WA',
            'joliet': 'Joliet, IL',
            'murfreesboro': 'Murfreesboro, TN',
            'midland': 'Midland, TX',
            'rockford': 'Rockford, IL',
            'paterson': 'Paterson, NJ',
            'savannah': 'Savannah, GA',
            'bridgeport': 'Bridgeport, CT',
            'torrance': 'Torrance, CA',
            'mcallen': 'McAllen, TX',
            'syracuse': 'Syracuse, NY',
            'surprise': 'Surprise, AZ',
            'denton': 'Denton, TX',
            'roseville': 'Roseville, CA',
            'thornton': 'Thornton, CO',
            'miramar': 'Miramar, FL',
            'pasadena': 'Pasadena, CA',
            'mesquite': 'Mesquite, TX',
            'olathe': 'Olathe, KS',
            'dayton': 'Dayton, OH',
            'carrollton': 'Carrollton, TX',
            'waco': 'Waco, TX',
            'orange': 'Orange, CA',
            'fullerton': 'Fullerton, CA',
            // 201-300
            'charleston': 'Charleston, SC',
            'west-valley-city': 'West Valley City, UT',
            'visalia': 'Visalia, CA',
            'gainesville': 'Gainesville, FL',
            'coral-springs': 'Coral Springs, FL',
            'cedar-rapids': 'Cedar Rapids, IA',
            'new-haven': 'New Haven, CT',
            'stamford': 'Stamford, CT',
            'elizabeth': 'Elizabeth, NJ',
            'concord': 'Concord, CA',
            'thousand-oaks': 'Thousand Oaks, CA',
            'kent': 'Kent, WA',
            'topeka': 'Topeka, KS',
            'simi-valley': 'Simi Valley, CA',
            'hartford': 'Hartford, CT',
            'fargo': 'Fargo, ND',
            'murrieta': 'Murrieta, CA',
            'round-rock': 'Round Rock, TX',
            'norman': 'Norman, OK',
            'berkeley': 'Berkeley, CA',
            'columbia': 'Columbia, SC',
            'santa-clara': 'Santa Clara, CA',
            'palm-bay': 'Palm Bay, FL',
            'el-monte': 'El Monte, CA',
            'ann-arbor': 'Ann Arbor, MI',
            'pearland': 'Pearland, TX',
            'allentown': 'Allentown, PA',
            'abilene': 'Abilene, TX',
            'richardson': 'Richardson, TX',
            'odessa': 'Odessa, TX',
            'arvada': 'Arvada, CO',
            'cambridge': 'Cambridge, MA',
            'sugar-land': 'Sugar Land, TX',
            'beaumont': 'Beaumont, TX',
            'lansing': 'Lansing, MI',
            'rochester': 'Rochester, MN',
            'evansville': 'Evansville, IN',
            'provo': 'Provo, UT',
            'carlsbad': 'Carlsbad, CA',
            'clearwater': 'Clearwater, FL',
            'west-jordan': 'West Jordan, UT',
            'college-station': 'College Station, TX',
            'westminster': 'Westminster, CO',
            'high-point': 'High Point, NC',
            'lowell': 'Lowell, MA',
            'fairfield': 'Fairfield, CA',
            'west-covina': 'West Covina, CA',
            'billings': 'Billings, MT',
            'murrieta': 'Murrieta, CA',
            'antioch': 'Antioch, CA',
            'manchester': 'Manchester, NH',
            'richmond': 'Richmond, CA',
            'norwalk': 'Norwalk, CA',
            'ventura': 'Ventura, CA',
            'temecula': 'Temecula, CA',
            'elgin': 'Elgin, IL',
            'downey': 'Downey, CA',
            'costa-mesa': 'Costa Mesa, CA',
            'inglewood': 'Inglewood, CA',
            'san-buenaventura': 'San Buenaventura, CA',
            'everett': 'Everett, WA',
            'wilmington': 'Wilmington, NC',
            'west-palm-beach': 'West Palm Beach, FL',
            'centennial': 'Centennial, CO',
            'boulder': 'Boulder, CO',
            'greeley': 'Greeley, CO',
            'daly-city': 'Daly City, CA',
            'north-charleston': 'North Charleston, SC',
            'broken-arrow': 'Broken Arrow, OK',
            'burbank': 'Burbank, CA',
            'el-cajon': 'El Cajon, CA',
            'south-bend': 'South Bend, IN',
            'rialto': 'Rialto, CA',
            'pompano-beach': 'Pompano Beach, FL',
            'jurupa-valley': 'Jurupa Valley, CA',
            'sandy-springs': 'Sandy Springs, GA',
            'green-bay': 'Green Bay, WI',
            'tyler': 'Tyler, TX',
            'davie': 'Davie, FL',
            'las-cruces': 'Las Cruces, NM',
            'south-fulton': 'South Fulton, GA',
            'san-mateo': 'San Mateo, CA',
            'lewisville': 'Lewisville, TX',
            'lakeland': 'Lakeland, FL',
            'edison': 'Edison, NJ',
            'davenport': 'Davenport, IA',
            'woodbridge': 'Woodbridge, NJ',
            'boca-raton': 'Boca Raton, FL',
            'renton': 'Renton, WA',
            'sparks': 'Sparks, NV',
            'vista': 'Vista, CA',
            'pueblo': 'Pueblo, CO',
            'san-angelo': 'San Angelo, TX',
            'kenosha': 'Kenosha, WI',
            'wichita-falls': 'Wichita Falls, TX',
            'vacaville': 'Vacaville, CA',
            'allen': 'Allen, TX',
            'rio-rancho': 'Rio Rancho, NM',
            'menifee': 'Menifee, CA',
            'flint': 'Flint, MI',
            'spokane-valley': 'Spokane Valley, WA',
            'san-leandro': 'San Leandro, CA',
            'vallejo': 'Vallejo, CA',
            'tuscaloosa': 'Tuscaloosa, AL',
            // Additional Florida cities (STS markets)
            'fort-lauderdale': 'Fort Lauderdale, FL',
            'ft-lauderdale': 'Fort Lauderdale, FL',
            'west-palm-beach': 'West Palm Beach, FL',
            'delray-beach': 'Delray Beach, FL',
            'boynton-beach': 'Boynton Beach, FL',
            'deerfield-beach': 'Deerfield Beach, FL',
            'pompano-beach': 'Pompano Beach, FL',
            'coral-springs': 'Coral Springs, FL',
            'coconut-creek': 'Coconut Creek, FL',
            'margate': 'Margate, FL',
            'tamarac': 'Tamarac, FL',
            'sunrise': 'Sunrise, FL',
            'plantation': 'Plantation, FL',
            'weston': 'Weston, FL',
            'davie': 'Davie, FL',
            'doral': 'Doral, FL',
            'homestead': 'Homestead, FL',
            'kendall': 'Kendall, FL',
            'north-miami': 'North Miami, FL',
            'north-miami-beach': 'North Miami Beach, FL',
            'aventura': 'Aventura, FL',
            'hallandale-beach': 'Hallandale Beach, FL',
            'lauderhill': 'Lauderhill, FL',
            'pembroke-pines': 'Pembroke Pines, FL',
            'miramar': 'Miramar, FL',
            'hollywood': 'Hollywood, FL',
            'miami-gardens': 'Miami Gardens, FL',
            'hialeah': 'Hialeah, FL',
            'cape-coral': 'Cape Coral, FL',
            'port-saint-lucie': 'Port Saint Lucie, FL',
            'port-st-lucie': 'Port Saint Lucie, FL',
            'palm-bay': 'Palm Bay, FL',
            'clearwater': 'Clearwater, FL',
            'gainesville': 'Gainesville, FL',
            'tallahassee': 'Tallahassee, FL',
            'orlando': 'Orlando, FL',
            'tampa': 'Tampa, FL',
            'saint-petersburg': 'Saint Petersburg, FL',
            'st-petersburg': 'Saint Petersburg, FL',
            'st-pete': 'Saint Petersburg, FL',
            // Additional Texas cities (STS markets)
            'the-woodlands': 'The Woodlands, TX',
            'katy': 'Katy, TX',
            'spring': 'Spring, TX',
            'humble': 'Humble, TX',
            'baytown': 'Baytown, TX',
            'pasadena': 'Pasadena, TX',
            'league-city': 'League City, TX',
            'friendswood': 'Friendswood, TX',
            'missouri-city': 'Missouri City, TX',
            'sugar-land': 'Sugar Land, TX',
            'pearland': 'Pearland, TX',
            'conroe': 'Conroe, TX',
            'round-rock': 'Round Rock, TX',
            'cedar-park': 'Cedar Park, TX',
            'georgetown': 'Georgetown, TX',
            'san-marcos': 'San Marcos, TX',
            'new-braunfels': 'New Braunfels, TX',
            // Additional Midwest cities (STS markets)
            'schaumburg': 'Schaumburg, IL',
            'naperville': 'Naperville, IL',
            'aurora': 'Aurora, IL',
            'joliet': 'Joliet, IL',
            'rockford': 'Rockford, IL',
            'elgin': 'Elgin, IL',
            'waukegan': 'Waukegan, IL',
            'evanston': 'Evanston, IL',
            'oak-park': 'Oak Park, IL',
            'cicero': 'Cicero, IL',
            'skokie': 'Skokie, IL',
            'des-plaines': 'Des Plaines, IL',
            'orland-park': 'Orland Park, IL',
            'tinley-park': 'Tinley Park, IL',
            'oak-lawn': 'Oak Lawn, IL',
            'downers-grove': 'Downers Grove, IL',
            'lombard': 'Lombard, IL',
            'wheaton': 'Wheaton, IL',
            'bloomington': 'Bloomington, IL',
            'champaign': 'Champaign, IL',
            'peoria': 'Peoria, IL',
            'springfield': 'Springfield, IL',
            'decatur': 'Decatur, IL',
            // Additional Michigan cities
            'grand-rapids': 'Grand Rapids, MI',
            'warren': 'Warren, MI',
            'sterling-heights': 'Sterling Heights, MI',
            'ann-arbor': 'Ann Arbor, MI',
            'lansing': 'Lansing, MI',
            'dearborn': 'Dearborn, MI',
            'livonia': 'Livonia, MI',
            'troy': 'Troy, MI',
            'farmington-hills': 'Farmington Hills, MI',
            'southfield': 'Southfield, MI',
            // Additional Wisconsin cities
            'madison': 'Madison, WI',
            'green-bay': 'Green Bay, WI',
            'kenosha': 'Kenosha, WI',
            'racine': 'Racine, WI',
            'appleton': 'Appleton, WI',
            'waukesha': 'Waukesha, WI',
            // Additional Minnesota cities  
            'saint-paul': 'Saint Paul, MN',
            'st-paul': 'Saint Paul, MN',
            'rochester': 'Rochester, MN',
            'duluth': 'Duluth, MN',
            'bloomington-mn': 'Bloomington, MN',
            'brooklyn-park': 'Brooklyn Park, MN',
            'plymouth': 'Plymouth, MN',
            'woodbury': 'Woodbury, MN',
            'maple-grove': 'Maple Grove, MN',
            'eden-prairie': 'Eden Prairie, MN',
            // Additional Ohio cities
            'akron': 'Akron, OH',
            'dayton': 'Dayton, OH',
            'toledo': 'Toledo, OH',
            'parma': 'Parma, OH',
            'canton': 'Canton, OH',
            'youngstown': 'Youngstown, OH',
            'lorain': 'Lorain, OH',
            // Additional Georgia cities
            'savannah': 'Savannah, GA',
            'augusta': 'Augusta, GA',
            'macon': 'Macon, GA',
            'sandy-springs': 'Sandy Springs, GA',
            'roswell': 'Roswell, GA',
            'johns-creek': 'Johns Creek, GA',
            'alpharetta': 'Alpharetta, GA',
            'marietta': 'Marietta, GA'
        };

        // === EXTRACT DATA ===
        function extractData() {
            const url = document.getElementById('pageURL').value.trim();
            if(!url) return showToast("Enter Target URL first!", true);

            const parts = url.replace(/\/$/, "").split('/');
            const slug = parts[parts.length - 1].toLowerCase();
            
            // Official Page Name from URL (preserve original case)
            const slugOriginal = parts[parts.length - 1];
            const pageName = slugOriginal.split('-').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' ');
            appState.pageName = pageName;
            document.getElementById('displayPageName').textContent = pageName;

            let city = '';
            let state = '';

            // Strategy 1: Check metro area lookup table first
            // Sort by key length (longest first) to match "saint-paul" before "paul"
            const sortedKeys = Object.keys(cityLookup).sort((a, b) => b.length - a.length);
            for(let key of sortedKeys) {
                if(slug.includes(key)) {
                    const cityState = cityLookup[key].split(', ');
                    city = cityState[0];
                    state = cityState[1];
                    break;
                }
            }

            // Strategy 2: If not found in lookup, use smart detection
            if(!city) {
                const nonCities = [
                    'electronic', 'electronics', 'recycling', 'recyclers', 'disposal', 'services', 'service',
                    'shredding', 'degaussing', 'hard', 'drive', 'waste', 'management', 'destruction',
                    'computer', 'laptop', 'server', 'network', 'equipment', 'certified', 'secure',
                    'free', 'pickup', 'drop', 'off', 'asset', 'recovery', 'data', 'itad',
                    'sts', 'inc', 'corp', 'logistics', 'it',
                    'for', 'in', 'the', 'and', 'of', 'with', 'to', 'at', 'by', 'on', 'or', 'a', 'an',
                    'areas', 'area', 'locations', 'location', 'near', 'nearby'
                ];
                
                const slugWords = slug.split('-');
                
                // Look for pattern "in-[CITY]"
                for(let i = 0; i < slugWords.length - 1; i++) {
                    if(slugWords[i].toLowerCase() === 'in') {
                        const potentialCity = slugWords[i + 1];
                        if(!nonCities.includes(potentialCity.toLowerCase())) {
                            city = potentialCity.charAt(0).toUpperCase() + potentialCity.slice(1).toLowerCase();
                            break;
                        }
                    }
                }
                
                // Fallback: first word not in blacklist
                if(!city) {
                    for(let word of slugWords) {
                        if(!nonCities.includes(word.toLowerCase()) && word.length > 2) {
                            city = word.charAt(0).toUpperCase() + word.slice(1).toLowerCase();
                            break;
                        }
                    }
                }
            }

            // Check for state abbreviation at end of slug (e.g., -mn, -tx)
            if(!state) {
                const stateAbbrevs = ['al','ak','az','ar','ca','co','ct','de','fl','ga','hi','id','il','in','ia','ks','ky','la','me','md','ma','mi','mn','ms','mo','mt','ne','nv','nh','nj','nm','ny','nc','nd','oh','ok','or','pa','ri','sc','sd','tn','tx','ut','vt','va','wa','wv','wi','wy','dc'];
                const slugWords = slug.split('-');
                const lastWord = slugWords[slugWords.length - 1].toLowerCase();
                if(stateAbbrevs.includes(lastWord)) {
                    state = lastWord.toUpperCase();
                }
            }

            // Detect niche from URL keywords - COMPREHENSIVE (40+ service types)
            let niche = 'Electronics Recycling'; // default
            const s = slug; // shorthand
            
            // GUIDES (check first - most specific)
            if(s.includes('healthcare-itad-guide') || s.includes('healthcare-itad-compliance')) {
                niche = 'Healthcare ITAD Compliance Guide';
            } else if(s.includes('education-it-disposal-guide') || s.includes('ferpa-guide')) {
                niche = 'Education IT Disposal Guide';
            } else if(s.includes('legal-data-destruction-guide')) {
                niche = 'Legal Data Destruction Guide';
            } else if(s.includes('financial-services-it-guide') || s.includes('financial-services-it-security')) {
                niche = 'Financial Services IT Security Guide';
            } else if(s.includes('it-asset-disposal-guide') || s.includes('asset-disposal-guide')) {
                niche = 'IT Asset Disposal Guide';
            } else if(s.includes('government-it-procurement-guide')) {
                niche = 'Government IT Procurement Guide';
            } else if(s.includes('military-electronics-disposal')) {
                niche = 'Military Electronics Disposal Guide';
            }
            // INDUSTRY-SPECIFIC SERVICES
            else if(s.includes('healthcare-itad')) {
                niche = 'Healthcare ITAD';
            } else if(s.includes('education-it-disposal')) {
                niche = 'Education IT Disposal';
            } else if(s.includes('government-electronics-recycling')) {
                niche = 'Government Electronics Recycling';
            } else if(s.includes('financial-services-it')) {
                niche = 'Financial Services IT Recycling';
            } else if(s.includes('law-firm-data-destruction') || s.includes('legal-firm-data-destruction') || s.includes('legal-data-destruction')) {
                niche = 'Legal Data Destruction';
            } else if(s.includes('school-electronics') || s.includes('school-recycling')) {
                niche = 'School Electronics Recycling';
            } else if(s.includes('medical-equipment-recycling')) {
                niche = 'Medical Equipment Recycling';
            }
            // EQUIPMENT-SPECIFIC
            else if(s.includes('hard-drive-shredding') || s.includes('hdd-shredding')) {
                niche = 'Hard Drive Shredding';
            } else if(s.includes('hard-drive-destruction')) {
                niche = 'Hard Drive Destruction';
            } else if(s.includes('hard-drive-wiping')) {
                niche = 'Hard Drive Wiping';
            } else if(s.includes('mobile-shredding')) {
                niche = 'Mobile Shredding';
            } else if(s.includes('server-recycling')) {
                niche = 'Server Recycling';
            } else if(s.includes('laptop-recycling')) {
                niche = 'Laptop Recycling';
            } else if(s.includes('monitor-recycling')) {
                niche = 'Monitor Recycling';
            } else if(s.includes('printer-recycling')) {
                niche = 'Printer Recycling';
            } else if(s.includes('cell-phone-recycling') || s.includes('cellphone-recycling')) {
                niche = 'Cell Phone Recycling';
            } else if(s.includes('tablet-recycling')) {
                niche = 'Tablet Recycling';
            } else if(s.includes('networking-equipment') || s.includes('network-equipment')) {
                niche = 'Networking Equipment Recycling';
            } else if(s.includes('it-equipment-recycling')) {
                niche = 'IT Equipment Recycling';
            }
            // CORE SERVICES
            else if(s.includes('computer-liquidation') || s.includes('liquidation')) {
                niche = 'Computer Liquidation';
            } else if(s.includes('asset-lifecycle') || s.includes('lifecycle-management')) {
                niche = 'Asset Lifecycle Management';
            } else if(s.includes('asset-recovery') || s.includes('reclaiming-your-assets')) {
                niche = 'Asset Recovery';
            } else if(s.includes('asset-tagging')) {
                niche = 'Asset Tagging';
            } else if(s.includes('certificate-of-destruction') || s.includes('certified-destruction')) {
                niche = 'Certificate of Destruction';
            } else if(s.includes('degaussing')) {
                niche = 'Degaussing Services';
            } else if(s.includes('data-destruction') || s.includes('secure-destruction')) {
                niche = 'Data Destruction';
            } else if(s.includes('it-asset-disposition') || s.includes('itad')) {
                niche = 'IT Asset Disposition';
            } else if(s.includes('it-asset-management') || s.includes('asset-management')) {
                niche = 'IT Asset Management';
            } else if(s.includes('lease-buyout') || s.includes('lease-buy-out')) {
                niche = 'Lease Buyout Services';
            } else if(s.includes('mail-in-recycling') || s.includes('mail-in')) {
                niche = 'Mail-In Recycling';
            } else if(s.includes('managed-service-provider') || s.includes('msp-services') || s.includes('-msp')) {
                niche = 'Managed Service Provider';
            } else if(s.includes('managed-it-services') || s.includes('managed-services')) {
                niche = 'Managed IT Services';
            } else if(s.includes('reverse-logistics')) {
                niche = 'Reverse Logistics';
            } else if(s.includes('data-center-decommission')) {
                niche = 'Data Center Decommissioning';
            }
            // RECYCLING TYPES
            else if(s.includes('e-waste-pickup')) {
                niche = 'E-Waste Pickup';
            } else if(s.includes('e-waste') || s.includes('ewaste')) {
                niche = 'E-Waste Recycling';
            } else if(s.includes('free-electronics-recycling') || s.includes('free-recycling')) {
                niche = 'Free Electronics Recycling';
            } else if(s.includes('free-pickup') || s.includes('pickup')) {
                niche = 'Free Electronics Pickup';
            } else if(s.includes('computer-recycling')) {
                niche = 'Computer Recycling';
            } else if(s.includes('electronic-recycling') || s.includes('electronics-recycling')) {
                niche = 'Electronics Recycling';
            } else if(s.includes('drop-off')) {
                niche = 'Electronics Drop-Off';
            }
            
            appState.niche = niche;
            document.getElementById('stsKeyword').value = niche;

            document.getElementById('cityName').value = city || '';
            document.getElementById('stateName').value = state || '';
            document.getElementById('dataArea').style.display = 'block';
            
            if(!appState.startTime) appState.startTime = Date.now();
            
            saveState();
            showToast("Data Extracted! City: " + (city || 'Not detected') + (state ? ', ' + state : '') + " | Niche: " + niche);
        }

        // === SEARCH GMB ===
        function searchGMB() {
            const city = document.getElementById('cityName').value.trim();
            const state = document.getElementById('stateName').value.trim();
            
            if(!city) {
                showToast("Enter City first!", true);
                return;
            }

            let searchQuery = city;
            if(state) searchQuery += ' ' + state;
            searchQuery += ' STS Electronic Recycling';

            const encodedQuery = encodeURIComponent(searchQuery);
            window.open(`https://www.google.com/maps/search/${encodedQuery}`, '_blank');
            showToast("Opening Google Maps...");
        }

        // === PARSE HUB+SPOKE HANDOFF ===
        function parseHubSpoke() {
            const handoff = document.getElementById('hubSpokeHandoff').value.trim();
            
            if(!handoff) {
                showToast("Paste Hub+Spoke handoff first!", true);
                return;
            }

            // Parse handoff data
            const parsed = {
                city: '',
                state: '',
                totalPages: 0,
                tier1Count: 0,
                tier2Count: 0,
                tier3Count: 0,
                tier4Count: 0,
                tier5Count: 0,
                hubPage: '',
                raw: handoff
            };

            // Extract city from title (e.g., "Minneapolis Minnesota - Internal Linking Reference")
            const titleMatch = handoff.match(/^([A-Za-z\s]+?)\s*[-–—]\s*Internal Linking/im) || 
                               handoff.match(/^([A-Za-z\s]+?)\s*[-–—]/m);
            if(titleMatch) {
                const cityState = titleMatch[1].trim();
                const parts = cityState.split(/\s+/);
                if(parts.length >= 2) {
                    const stateNames = ['Alabama','Alaska','Arizona','Arkansas','California','Colorado','Connecticut','Delaware','Florida','Georgia','Hawaii','Idaho','Illinois','Indiana','Iowa','Kansas','Kentucky','Louisiana','Maine','Maryland','Massachusetts','Michigan','Minnesota','Mississippi','Missouri','Montana','Nebraska','Nevada','New Hampshire','New Jersey','New Mexico','New York','North Carolina','North Dakota','Ohio','Oklahoma','Oregon','Pennsylvania','Rhode Island','South Carolina','South Dakota','Tennessee','Texas','Utah','Vermont','Virginia','Washington','West Virginia','Wisconsin','Wyoming'];
                    const lastPart = parts[parts.length - 1];
                    if(stateNames.includes(lastPart)) {
                        parsed.state = lastPart;
                        parsed.city = parts.slice(0, -1).join(' ');
                    } else {
                        parsed.city = cityState;
                    }
                } else {
                    parsed.city = cityState;
                }
            }

            // Extract total pages
            const totalMatch = handoff.match(/Total\s*Pages[:\s]*(\d+)/i);
            if(totalMatch) {
                parsed.totalPages = parseInt(totalMatch[1]);
            }

            // Split by tier sections and count URL slugs in each
            // URL slugs look like: city-slug-name — Description
            const urlPattern = /^[a-z]+-[a-z0-9-]+\s*[-–—]/gim;
            
            // Find tier sections
            const sections = handoff.split(/\n(?=Tier\s*\d)/i);
            
            sections.forEach(section => {
                const tierMatch = section.match(/^Tier\s*(\d)/i);
                if(tierMatch) {
                    const tierNum = parseInt(tierMatch[1]);
                    const urls = section.match(urlPattern);
                    const count = urls ? urls.length : 0;
                    
                    switch(tierNum) {
                        case 1: parsed.tier1Count = count; break;
                        case 2: parsed.tier2Count = count; break;
                        case 3: parsed.tier3Count = count; break;
                        case 4: parsed.tier4Count = count; break;
                        case 5: parsed.tier5Count = count; break;
                    }
                }
            });

            // If no tiers found, count all URLs
            if(parsed.tier1Count + parsed.tier2Count + parsed.tier3Count + parsed.tier4Count + parsed.tier5Count === 0) {
                const allUrls = handoff.match(urlPattern);
                parsed.totalPages = allUrls ? allUrls.length : parsed.totalPages;
            }

            // Find hub page (usually city-state like "minneapolis-mn" with "Hub" nearby)
            const hubMatch = handoff.match(/([a-z]+-[a-z]{2})\s*[-–—]\s*Hub/i) ||
                            handoff.match(/Hub.*?([a-z]+-[a-z]{2})\b/i);
            if(hubMatch) {
                parsed.hubPage = hubMatch[1];
            } else {
                // Try to find the main city page (city-state pattern)
                const citySlug = parsed.city.toLowerCase().replace(/\s+/g, '-');
                const stateAbbr = parsed.state ? getStateAbbr(parsed.state) : '';
                if(stateAbbr) {
                    parsed.hubPage = citySlug + '-' + stateAbbr.toLowerCase();
                }
            }

            // Store parsed data
            appState.parsedHubSpoke = parsed;
            saveState();

            // Update display
            document.getElementById('hubspoke-city').textContent = parsed.city + (parsed.state ? ', ' + parsed.state : '') || 'Could not detect';
            document.getElementById('hubspoke-total').textContent = parsed.totalPages || (parsed.tier1Count + parsed.tier2Count + parsed.tier3Count + parsed.tier4Count + parsed.tier5Count) || 'Not specified';
            document.getElementById('hubspoke-tier1').textContent = parsed.tier1Count + ' pages';
            document.getElementById('hubspoke-tiers').textContent = 
                `T2: ${parsed.tier2Count} | T3: ${parsed.tier3Count} | T4: ${parsed.tier4Count} | T5: ${parsed.tier5Count}`;
            document.getElementById('hubspoke-hubpage').textContent = parsed.hubPage || 'Auto-detect';

            // Show parsed area
            document.getElementById('parsedHubSpokeArea').style.display = 'block';
            
            showToast("Hub+Spoke Strategy Loaded! " + (parsed.tier1Count + parsed.tier2Count + parsed.tier3Count + parsed.tier4Count + parsed.tier5Count) + " URLs detected");
        }
        
        // Helper: Get state abbreviation
        function getStateAbbr(stateName) {
            const states = {
                'Alabama': 'AL', 'Alaska': 'AK', 'Arizona': 'AZ', 'Arkansas': 'AR', 'California': 'CA',
                'Colorado': 'CO', 'Connecticut': 'CT', 'Delaware': 'DE', 'Florida': 'FL', 'Georgia': 'GA',
                'Hawaii': 'HI', 'Idaho': 'ID', 'Illinois': 'IL', 'Indiana': 'IN', 'Iowa': 'IA',
                'Kansas': 'KS', 'Kentucky': 'KY', 'Louisiana': 'LA', 'Maine': 'ME', 'Maryland': 'MD',
                'Massachusetts': 'MA', 'Michigan': 'MI', 'Minnesota': 'MN', 'Mississippi': 'MS', 'Missouri': 'MO',
                'Montana': 'MT', 'Nebraska': 'NE', 'Nevada': 'NV', 'New Hampshire': 'NH', 'New Jersey': 'NJ',
                'New Mexico': 'NM', 'New York': 'NY', 'North Carolina': 'NC', 'North Dakota': 'ND', 'Ohio': 'OH',
                'Oklahoma': 'OK', 'Oregon': 'OR', 'Pennsylvania': 'PA', 'Rhode Island': 'RI', 'South Carolina': 'SC',
                'South Dakota': 'SD', 'Tennessee': 'TN', 'Texas': 'TX', 'Utah': 'UT', 'Vermont': 'VT',
                'Virginia': 'VA', 'Washington': 'WA', 'West Virginia': 'WV', 'Wisconsin': 'WI', 'Wyoming': 'WY'
            };
            return states[stateName] || '';
        }

        // === PARSE & VERIFY GMB ===
        function parseVerify() {
            const gmbData = document.getElementById('gmbData').value.trim();
            const gmbURL = document.getElementById('gmbURL').value.trim();

            if(!gmbData) {
                showToast("Paste GMB Data first!", true);
                return;
            }

            // Parse GMB Data
            const parsed = parseGMBData(gmbData);
            appState.parsedGMB = parsed;

            // Extract CID from URL - EXTRACTS SECOND HEX (true CID, not FID)
            // Format: 0x[FID]:0x[CID] - we need the SECOND hex value converted to decimal
            let cid = "NOT FOUND";
            let cidSource = "";
            if(gmbURL) {
                // Format: !1s0x88f50f2adabff44b:0xeec57509d117afea
                const hexMatch = gmbURL.match(/!1s(0x[a-fA-F0-9]+):(0x[a-fA-F0-9]+)/);
                if(hexMatch) {
                    // hexMatch[1] = FID (first hex) - NOT used for schema
                    // hexMatch[2] = CID (second hex) - THIS is what schema needs
                    const secondHex = hexMatch[2].substring(2); // Remove "0x" prefix
                    try {
                        // Convert hex to decimal using BigInt for large numbers
                        cid = BigInt("0x" + secondHex).toString();
                        cidSource = "auto-extracted";
                    } catch(e) {
                        console.error("Hex conversion failed:", e);
                        cid = "CONVERSION ERROR";
                    }
                } else if(gmbURL.includes("cid=")) {
                    // Already decimal format
                    cid = gmbURL.split("cid=")[1].split("&")[0].split("#")[0];
                    cidSource = "from-url-param";
                }
            }
            appState.cid = cid;
            appState.cidSource = cidSource;

            // Extract State from parsed address
            if(parsed.address) {
                const stateMatch = parsed.address.match(/,\s*([A-Z]{2})\s+\d{5}/);
                if(stateMatch) {
                    const stateAbbrev = stateMatch[1];
                    document.getElementById('stateName').value = stateAbbrev;
                    appState.state = stateAbbrev;
                    parsed.state = stateAbbrev;
                }
            }

            // Display results
            document.getElementById('parsedGMBArea').style.display = 'block';
            document.getElementById('cidDisplay').textContent = cid;
            displayParsedGMB();
            updateSchemaCIDDisplay();

            showToast("GMB Data Parsed!");
            saveState();
        }

        function parseGMBData(raw) {
            const lines = raw.split('\n').map(l => l.trim()).filter(l => l);
            const rawLower = raw.toLowerCase();
            
            let parsed = {
                name: '',
                address: '',
                fullAddress: '',
                cityState: '',
                zip: '',
                phone: '',
                website: '',
                hours: '',
                hoursDetail: [],
                rating: '',
                reviews: '',
                reviewCount: '',
                category: '',
                plusCode: '',
                serviceOptions: ''
            };

            // Find business name (STS Electronic Recycling)
            for(let line of lines) {
                if(line.toLowerCase().includes('sts electronic') || line.toLowerCase().includes('sts recycling')) {
                    parsed.name = line;
                    break;
                }
            }

            // Find rating - IMPROVED: Look for rating+reviews pattern first (most reliable)
            // Pattern: "4.9 (118)" or "4.9 ★★★★★ (118)" or "4.9(118)"
            for(let line of lines) {
                // Best pattern: rating followed by review count in parentheses
                const ratingReviewMatch = line.match(/(\d\.\d)\s*[★⭐]*\s*\((\d[\d,]*)\)/);
                if(ratingReviewMatch) {
                    parsed.rating = ratingReviewMatch[1] + ' ★';
                    parsed.reviews = ratingReviewMatch[2].replace(',', '') + ' reviews';
                    parsed.reviewCount = ratingReviewMatch[2].replace(',', '');
                    break;
                }
            }
            
            // Fallback: Look for "X stars" pattern if no rating found yet
            if(!parsed.rating) {
                for(let line of lines) {
                    const starsMatch = line.match(/(\d\.?\d?)\s*stars?/i);
                    if(starsMatch) {
                        parsed.rating = starsMatch[1] + ' ★';
                        break;
                    }
                }
            }
            
            // Last resort: standalone rating at start of line (risky - might grab wrong number)
            if(!parsed.rating) {
                for(let line of lines) {
                    const ratingMatch = line.match(/^(\d\.\d)\s*$/);
                    if(ratingMatch && parseFloat(ratingMatch[1]) >= 1.0 && parseFloat(ratingMatch[1]) <= 5.0) {
                        parsed.rating = ratingMatch[1] + ' ★';
                        break;
                    }
                }
            }

            // Find reviews count if not already found with rating
            if(!parsed.reviews) {
                for(let line of lines) {
                    const reviewMatch = line.match(/(\d[\d,]*)\s*reviews?/i);
                    if(reviewMatch) {
                        parsed.reviews = reviewMatch[1].replace(',', '') + ' reviews';
                        parsed.reviewCount = reviewMatch[1].replace(',', '');
                        break;
                    }
                    // Check for (123) pattern 
                    const parenMatch = line.match(/\((\d[\d,]*)\)/);
                    if(parenMatch && !parsed.reviews && parseInt(parenMatch[1].replace(',','')) > 5) {
                        parsed.reviews = parenMatch[1].replace(',', '') + ' reviews';
                        parsed.reviewCount = parenMatch[1].replace(',', '');
                    }
                }
            }

            // Find category (e.g., "Recycling center", "Electronics store")
            const categoryPatterns = ['recycling center', 'recycling drop-off', 'electronics store', 'computer service', 'data recovery', 'waste management'];
            for(let line of lines) {
                for(let cat of categoryPatterns) {
                    if(line.toLowerCase().includes(cat)) {
                        parsed.category = line;
                        break;
                    }
                }
            }

            // Find address - look for street number pattern and build full address
            let addressLines = [];
            for(let i = 0; i < lines.length; i++) {
                const line = lines[i];
                // Street address usually starts with number
                if(/^\d+\s+[A-Za-z]/.test(line) && !line.includes('review') && !line.includes('star')) {
                    addressLines.push(line);
                    // Check next lines for city, state, zip
                    for(let j = i + 1; j < Math.min(i + 3, lines.length); j++) {
                        const nextLine = lines[j];
                        // City, State ZIP pattern
                        if(/[A-Z]{2}\s+\d{5}/.test(nextLine) || /^[A-Za-z\s]+,\s*[A-Z]{2}/.test(nextLine)) {
                            addressLines.push(nextLine);
                        }
                    }
                    break;
                }
            }
            
            if(addressLines.length > 0) {
                parsed.fullAddress = addressLines.join(', ');
                parsed.address = addressLines[0]; // Street only
                
                // Extract city, state, zip
                const fullAddr = parsed.fullAddress;
                const csMatch = fullAddr.match(/([A-Za-z\s]+),\s*([A-Z]{2})\s*(\d{5})?/);
                if(csMatch) {
                    parsed.cityState = csMatch[1].trim() + ', ' + csMatch[2];
                    if(csMatch[3]) parsed.zip = csMatch[3];
                }
            }

            // Find phone number
            for(let line of lines) {
                const phoneMatch = line.match(/\(?\d{3}\)?[-.\s]?\d{3}[-.\s]?\d{4}/);
                if(phoneMatch) {
                    parsed.phone = phoneMatch[0];
                    break;
                }
            }

            // Find website
            for(let line of lines) {
                if(line.includes('stselectronicrecycling') || line.includes('stsrecycle')) {
                    parsed.website = line;
                    break;
                }
            }

            // FORCE STANDARD BUSINESS HOURS (9-5 Mon-Fri for all STS locations)
            const standardHours = [
                'Monday: 9 AM – 5 PM',
                'Tuesday: 9 AM – 5 PM',
                'Wednesday: 9 AM – 5 PM',
                'Thursday: 9 AM – 5 PM',
                'Friday: 9 AM – 5 PM',
                'Saturday: Closed',
                'Sunday: Closed'
            ];
            parsed.hoursDetail = standardHours;
            parsed.hours = 'Mon-Fri: 9 AM – 5 PM | Sat-Sun: Closed';

            // Find Plus Code (if present)
            for(let line of lines) {
                if(/^[A-Z0-9]{4}\+[A-Z0-9]{2,3}\s/.test(line)) {
                    parsed.plusCode = line;
                    break;
                }
            }

            // Find service options (e.g., "In-store pickup", "Delivery")
            const servicePatterns = ['in-store', 'pickup', 'delivery', 'drive-through', 'curbside', 'appointment'];
            let services = [];
            for(let line of lines) {
                const lineLower = line.toLowerCase();
                for(let svc of servicePatterns) {
                    if(lineLower.includes(svc) && !services.includes(line)) {
                        services.push(line);
                    }
                }
            }
            if(services.length > 0) {
                parsed.serviceOptions = services.join(', ');
            }

            return parsed;
        }

        function displayParsedGMB() {
            const p = appState.parsedGMB;
            document.getElementById('parsed-name').textContent = p.name || '—';
            document.getElementById('parsed-category').textContent = p.category || '—';
            document.getElementById('parsed-address').textContent = p.address || '—';
            document.getElementById('parsed-citystate').textContent = p.cityState || '—';
            document.getElementById('parsed-fulladdress').textContent = p.fullAddress || '—';
            document.getElementById('parsed-phone').textContent = p.phone || '—';
            document.getElementById('parsed-website').textContent = p.website || '—';
            document.getElementById('parsed-services').textContent = p.serviceOptions || '—';
            
            // Show detailed hours if available
            if(p.hoursDetail && p.hoursDetail.length > 0) {
                document.getElementById('parsed-hours').textContent = p.hoursDetail.join('\n');
            } else {
                document.getElementById('parsed-hours').textContent = p.hours || '—';
            }
        }

        function copyParsedGMB() {
            const p = appState.parsedGMB;
            const text = `GMB DATA - ${p.name || 'STS Electronic Recycling'}
═══════════════════════════════════
Business: ${p.name || '—'}
Category: ${p.category || '—'}

ADDRESS:
${p.address || '—'}
${p.cityState || '—'} ${p.zip || ''}
Full: ${p.fullAddress || '—'}

CONTACT:
Phone: ${p.phone || '—'}
Website: ${p.website || '—'}

HOURS:
${p.hoursDetail ? p.hoursDetail.join('\n') : (p.hours || '—')}

SERVICES: ${p.serviceOptions || '—'}
═══════════════════════════════════`;
            
            navigator.clipboard.writeText(text).then(() => {
                showToast("Parsed GMB Data Copied!");
            });
        }

        // === CID FUNCTIONS ===
        function testCID() {
            const cid = appState.cid;
            if(cid && cid !== "NOT FOUND") {
                window.open(`https://www.google.com/maps?cid=${cid}`, '_blank');
                showToast("Testing CID in Maps...");
            } else {
                showToast("No valid CID found!", true);
            }
        }

        function acceptCID() {
            appState.cidAccepted = true;
            document.getElementById('cidStatus').innerHTML = '<span style="color:#059669;">✓ CID ACCEPTED - Ready to proceed</span>';
            saveState();
            showToast("CID Accepted!");
        }

        function rejectCID() {
            appState.cidAccepted = false;
            document.getElementById('cidStatus').innerHTML = `<span style="color:#dc2626;">✗ CID REJECTED</span><br>
                <span style="font-size:12px; color:#64748b; margin-top:5px; display:block;">
                    Use this tool to find the correct CID: 
                    <a href="https://daltonluka.com/blog/cid-converter" target="_blank" style="color:var(--primary); font-weight:600;">
                        CID Converter Tool →
                    </a>
                </span>`;
            saveState();
            showToast("CID Rejected - Use converter tool to find correct CID", true);
        }

        function useManualCID() {
            const manualCID = document.getElementById('manualCID').value.trim();
            if(!manualCID) {
                showToast("Enter a CID first!", true);
                return;
            }
            
            appState.cid = manualCID;
            document.getElementById('cidDisplay').textContent = manualCID;
            document.getElementById('cidStatus').innerHTML = '<span style="color:#f59e0b;">⚡ Manual CID Set - Test it before accepting</span>';
            updateSchemaCIDDisplay();
            saveState();
            showToast("Manual CID set! Now test it.");
        }

        // === OPEN LIVE PAGE ===
        function openLivePage() {
            const url = document.getElementById('pageURL').value;
            if(url) {
                window.open(url, '_blank');
            } else {
                showToast("No URL set!", true);
            }
        }

        // === SCHEMA VALIDATOR ===
        function validateSchema() {
            const code = document.getElementById('schemaPaste').value;
            const resultsDiv = document.getElementById('schemaResults');
            
            if(!code.trim()) {
                showToast("Paste schema code first!", true);
                return;
            }

            let checks = [];
            let hasErrors = false;

            // Check 1: Script tags
            if(code.includes('<script') && code.includes('</' + 'script>')) {
                checks.push({ pass: true, text: 'Script tags present' });
            } else {
                checks.push({ pass: false, text: 'Missing script tags' });
                hasErrors = true;
            }

            // Check 2: JSON-LD
            if(code.includes('application/ld+json')) {
                checks.push({ pass: true, text: 'JSON-LD format' });
            } else {
                checks.push({ pass: false, text: 'Missing JSON-LD format' });
                hasErrors = true;
            }

            // Check 3: CID - CRITICAL
            if(appState.cid && appState.cid !== "NOT FOUND" && appState.cidAccepted) {
                if(code.includes(appState.cid)) {
                    checks.push({ pass: true, text: 'CID VERIFIED: ' + appState.cid.substring(0, 20) + '...' });
                } else {
                    checks.push({ pass: false, text: 'CID MISSING! Expected: ' + appState.cid });
                    hasErrors = true;
                }
            } else {
                checks.push({ pass: false, text: 'CID not accepted yet - go back to Mission Control' });
                hasErrors = true;
            }

            // Check 4: City name
            const city = appState.city;
            if(city && code.toLowerCase().includes(city.toLowerCase())) {
                checks.push({ pass: true, text: 'City "' + city + '" found' });
            } else if(city) {
                checks.push({ pass: false, text: 'City "' + city + '" NOT found' });
                hasErrors = true;
            }

            // Check 5: Electronic Recycling
            if(code.toLowerCase().includes('electronic') && code.toLowerCase().includes('recycling')) {
                checks.push({ pass: true, text: '"Electronic Recycling" keyword found' });
            } else {
                checks.push({ pass: false, text: 'Missing "Electronic Recycling"' });
                hasErrors = true;
            }

            // Check 6: Address
            if(code.includes('streetAddress') || code.includes('address')) {
                checks.push({ pass: true, text: 'Address field present' });
            } else {
                checks.push({ pass: false, text: 'Missing address' });
                hasErrors = true;
            }

            // Build results
            let html = `<div class="schema-results ${hasErrors ? 'fail' : 'pass'}">`;
            html += `<strong>${hasErrors ? '❌ Issues Found' : '✅ Schema Valid'}</strong><br><br>`;
            
            checks.forEach(c => {
                html += `<div class="schema-check-item ${c.pass ? 'pass' : 'fail'}">`;
                html += `<i class="fas ${c.pass ? 'fa-check-circle' : 'fa-times-circle'}"></i> ${c.text}`;
                html += `</div>`;
            });

            html += '</div>';
            resultsDiv.innerHTML = html;
        }

        // === SCHEMA CID COPY ===
        function copySchemaCID() {
            const cid = appState.cid || '';
            if (!cid) {
                showToast('No CID available - complete Mission Control first', true);
                return;
            }
            navigator.clipboard.writeText(cid).then(() => {
                showToast('CID Copied!');
            }).catch(err => {
                console.error('Copy failed:', err);
                showToast('Copy failed', true);
            });
        }

        function updateSchemaCIDDisplay() {
            const cid = appState.cid || '—';
            const cidEl = document.getElementById('schemaCID');
            const linkEl = document.getElementById('schemaCIDLink');
            if (cidEl) cidEl.textContent = cid;
            if (linkEl && cid && cid !== '—') {
                linkEl.href = `https://www.google.com/maps?cid=${cid}`;
                linkEl.style.display = 'inline-block';
            } else if (linkEl) {
                linkEl.style.display = 'none';
            }
        }

        // === PROMPTS ===
        function copyPrompt(type) {
            let text = "";
            const city = document.getElementById('cityName').value || "[CITY]";
            const state = document.getElementById('stateName').value || "";
            const url = document.getElementById('pageURL').value || "[URL]";
            const cid = appState.cid || "[CID]";
            const pageName = appState.pageName || "[PAGE NAME]";
            const p = appState.parsedGMB || {};
            const niche = document.getElementById('stsKeyword').value || appState.niche || 'Electronics Recycling';
            const hubSpoke = document.getElementById('hubSpokeHandoff').value || '';

            const forcePrefix = "CRITICAL SYSTEM INSTRUCTION: Execute ALL steps exhaustively. Do NOT summarize. Do NOT skip any section. Do NOT take shortcuts. Complete every single requirement. Stop and alert if errors occur.\n\n";

            switch(type) {
                case 'intro': {
                    const chatName = `${city} ${niche}`;
                    
                    text = `CHAT NAME: "${chatName}"

═══════════════════════════════════
SYSTEM INSTRUCTIONS
═══════════════════════════════════

You are building a landing page for STS Electronic Recycling. This workflow involves multiple documents, prompts, and strict requirements.

RULES FOR THIS ENTIRE SESSION:
1. Follow ALL instructions exactly — no shortcuts, no summarizing, no skipping steps
2. Execute EVERY prompt completely before asking questions
3. Keep responses TIGHT — essentials only, no fluff or excessive explanations
4. When given documents/files, read them thoroughly before proceeding
5. Do NOT hallucinate — if unsure, ask
6. Maintain consistency across all prompts in this session
7. ALL HTML/CODE OUTPUT → CREATE AS ARTIFACT (visual preview), NEVER paste code in chat

TARGET: ${city}${state ? ', ' + state : ''}
NICHE: ${niche}
URL: ${url}

Confirm you understand these rules. One word: "Ready."`;
                    break;
                }

                case 'build': {
                    const hoursText = p.hoursDetail ? p.hoursDetail.join('\n') : (p.hours || '[FROM GMB]');
                    
                    // Build Hub+Spoke section if handoff exists
                    const hubSpokeSection = hubSpoke ? `
═══════════════════════════════════
INTERNAL LINKING STRATEGY (Hub+Spoke)
═══════════════════════════════════
${hubSpoke}

LINKING INSTRUCTIONS:
- Add 3-4 internal links per page in content sections (rows 4+, NOT hero)
- Use full HTTPS URLs from the handoff above
- Reference local context (institutions, employers) in anchor text
- Links open in same tab (no target="_blank")
═══════════════════════════════════
` : '';

                    text = `${forcePrefix}TASK: Build Landing Page for ${city}${state ? ', ' + state : ''} — ${niche}

═══════════════════════════════════
TARGET URL: ${url}
NICHE: ${niche}
═══════════════════════════════════

GMB CID (VERIFIED): ${cid}
Google Maps Link: https://www.google.com/maps?cid=${cid}

═══════════════════════════════════
COMPLETE GMB DATA:
═══════════════════════════════════
Business Name: ${p.name || 'STS Electronic Recycling'}
Category: ${p.category || 'Recycling Center'}

FULL ADDRESS:
${p.address || '[STREET]'}
${p.cityState || city}${p.zip ? ' ' + p.zip : ''}
Complete: ${p.fullAddress || '[FULL ADDRESS]'}

CONTACT:
Phone: ${p.phone || '[PHONE]'}
Website: ${p.website || 'stselectronicrecyclinginc.com'}

HOURS:
${hoursText}

SERVICES: ${p.serviceOptions || 'Electronics Recycling, Data Destruction'}
═══════════════════════════════════
${hubSpokeSection}
EXECUTION INSTRUCTIONS:
1. Use Master Page Builder logic - follow EVERY step
2. Apply Master Design Bible strictly - NO deviations
3. Include ALL GMB data exactly as shown above
4. Hero section MUST have city "${city}" + niche "${niche}" in H1, form on RIGHT
5. Footer MUST have exact address: ${p.fullAddress || '[ADDRESS]'}
6. Footer MUST have phone: ${p.phone || '[PHONE]'}
7. Mobile responsive - images must NOT squeeze text
8. Do NOT include Schema (Phase 5 task)
${hubSpoke ? '9. Include 3-4 internal links from Hub+Spoke handoff in rows 4+ (NOT hero)' : ''}

⚠️ CRITICAL OUTPUT REQUIREMENT:
CREATE AN ARTIFACT with the complete HTML code. Do NOT paste code in chat.
The artifact must be viewable/previewable. Name it: "${city}-${niche.replace(/\s+/g, '-').toLowerCase()}.html"

BEGIN BUILD NOW.`;
                    break;
                }

                case 'rebuild': {
                    const issue = document.getElementById('rebuildIssue')?.value || 'Design Bible not followed';
                    text = `${forcePrefix}TASK: COMPLETE REBUILD REQUIRED

THE ISSUE: ${issue}

INSTRUCTIONS:
1. DELETE your previous output completely
2. Re-read the Master Design Bible file
3. Rebuild the ENTIRE page from scratch
4. Fix the specific issue mentioned above
5. Ensure Hero has city in H1, form on RIGHT
6. Ensure mobile view works - no image squeeze

⚠️ CRITICAL OUTPUT REQUIREMENT:
CREATE A NEW ARTIFACT with the complete rebuilt HTML code. Do NOT paste code in chat.
The artifact must be viewable/previewable. Replace the previous artifact.

DO NOT try to patch the old code. START FRESH.`;
                    break;
                }

                case 'verify-links':
                    text = `${forcePrefix}TASK: VERIFY ALL LINKS

Scan the HTML and verify:

1. ALL email links = mailto:recycle@stsrecycle.com
2. ALL contact/quote buttons = https://www.stselectronicrecyclinginc.com/CONTACT-STS-PAGE
3. NO made-up URLs (LLMs invent URLs!)
4. NO example.com or placeholder links
5. ALL phone numbers correct

List ANY issues. If clean: "All links verified."`;
                    break;

                case 'verify-hubspoke':
                    if(!hubSpoke) {
                        showToast("No Hub+Spoke handoff loaded! Load it in Mission Control first.", true);
                        return;
                    }
                    text = `${forcePrefix}TASK: VERIFY HUB+SPOKE INTERNAL LINKING

═══════════════════════════════════
HUB+SPOKE HANDOFF REFERENCE
═══════════════════════════════════
${hubSpoke}
═══════════════════════════════════

PART 1: CONTEXTUAL LINKS IN BODY
═══════════════════════════════════
Verify 3-4 internal links exist in content sections (rows 4+, NOT hero):

☐ Full HTTPS URLs from handoff above
☐ Links open in same tab (no target="_blank")
☐ Local context referenced in anchor text where appropriate
☐ Links are naturally woven into content, not forced

If missing or incorrect → ADD or FIX them now.

═══════════════════════════════════
PART 2: "Related ${city} Services" SECTION
═══════════════════════════════════
This section appears ABOVE the final CTA row ("Ready to Get Started?").
It has a 3-COLUMN layout with cards. Replace/verify links match the Hub+Spoke handoff:

COLUMN 1 — "Core ITAD Services" (3-5 links)
→ Pull from Tier 1 (Hub + Core Services)
→ Example: ${city} Electronics Recycling Hub, ${city} ITAD Services, Hard Drive Shredding, Computer Liquidation

COLUMN 2 — "Support Services" (3-5 links)
→ Pull from Tier 2 (Equipment) + Tier 3 (Methods)
→ Example: Certificate of Destruction, Reverse Logistics, Asset Tagging, Medical Equipment Recycling

COLUMN 3 — "Industry Solutions" (3-5 links)
→ Pull from Tier 4 (Strategic Verticals)
→ Example: Healthcare ITAD, Education IT Disposal, Government Electronics, Financial Services IT

═══════════════════════════════════
PART 3: LEAD GEN GUIDE CTA BOX
═══════════════════════════════════
BELOW the 3-column section, add a prominent guide download CTA:

☐ Heading: "📄 Free Download: [Guide Name]"
☐ Brief description mentioning ${city} businesses
☐ "Download Free Guide" button
☐ Pull ONE featured guide from Tier 5 (Lead Gen Guides)

═══════════════════════════════════
VERIFICATION CHECKLIST
═══════════════════════════════════
☐ Section heading says "Related ${city} Services" (correct city)
☐ Subheading mentions ${city} businesses
☐ All 3 columns have 3-5 links each
☐ All URLs are full HTTPS format from handoff
☐ Guide CTA box features a Tier 5 guide
☐ No placeholder or made-up URLs

═══════════════════════════════════
OUTPUT
═══════════════════════════════════
If fixes needed → Output corrected HTML
If everything is clean → "✅ Hub+Spoke verified — all links correct"`;
                    break;

                case 'seo':
                    text = `${forcePrefix}TASK: FULL SEO AUDIT

CRITICAL RULES:
- Execute EVERY SINGLE STEP in the SEO Audit file
- Do NOT skip any optimization
- The first 2 rows (Hero section) = MINOR tweaks only, no major changes
- STRIP/REMOVE all existing Schema (rebuilt separately)
- Verify emails = mailto:recycle@stsrecycle.com
${hubSpoke ? '- Verify 3-4 internal links exist in content sections (rows 4+, NOT hero)' : ''}

Complete the ENTIRE audit. Do not stop early. Do not summarize.

Output the optimized HTML (without schema).`;
                    break;

                case 'seo-verify':
                    // Build Hub+Spoke verification section if handoff exists
                    const hubSpokeVerifySection = hubSpoke ? `
INTERNAL LINKING (Hub+Spoke):
☐ 3-4 internal links present in content sections (rows 4+)
☐ NO internal links in hero section
☐ All URLs match the Hub+Spoke handoff exactly
☐ Links use full HTTPS format
☐ Links open in same tab (no target="_blank")
☐ Local context referenced in anchor text where appropriate

HUB+SPOKE REFERENCE:
${hubSpoke}

` : '';
                    text = `${forcePrefix}TASK: SEO VERIFICATION AUDIT

This page has already gone through our Master SEO Audit.
Now verify compliance and check against modern standards.

════════════════════════════════════════════════════════
PART 1: MASTER SEO AUDIT COMPLIANCE CHECK
════════════════════════════════════════════════════════

Verify these items were executed from our SEO Audit:

TECHNICAL:
☐ Meta title: Present, 50-60 chars, includes city + niche
☐ Meta description: Present, 150-160 chars, compelling CTA
☐ H1: ONE only, contains city name
☐ H2-H6: Logical hierarchy, no skipped levels
☐ Image alt tags: All images have descriptive alts
☐ Internal links: Functional, no placeholders

LOCAL SEO:
☐ NAP in footer matches GMB exactly
☐ City mentioned in first 100 words
☐ Phone number clickable (tel: link)
☐ Email is mailto:recycle@stsrecycle.com

${hubSpokeVerifySection}CLEANUP:
☐ Schema REMOVED (rebuilt in Phase 5)
☐ No broken/placeholder links
☐ No lorem ipsum or [PLACEHOLDER] text

FLAG 1 - AUDIT COMPLIANCE:
✓ ALL STEPS FOLLOWED — or —
⚠️ INCOMPLETE — List what's missing

════════════════════════════════════════════════════════
PART 2: MODERN SEO STANDARDS (Web Search Required)
════════════════════════════════════════════════════════

Search the web for CURRENT (2025-2026) SEO best practices.

SEARCH THESE SOURCES:
• Google Search Central — latest algorithm updates
• Reddit r/SEO, r/bigseo, r/localseo — current trends
• AI SEO optimization techniques (2025+)
• Local/Geo SEO innovations
• E-E-A-T signals (Experience, Expertise, Authority, Trust)
• Core Web Vitals considerations for landing pages

Score this page against what you find.

MODERN SEO SCORE: __/100

QUICK WINS (max 3):
• [Actionable improvement]
• [Actionable improvement]
• [Actionable improvement]

FLAG 2 - MODERN COMPLIANCE:
✓ UP TO DATE — Follows current best practices — or —
⚠️ NEEDS ATTENTION — [Brief reason]

════════════════════════════════════════════════════════
FINAL VERDICT
════════════════════════════════════════════════════════
[One line summary: Ready to proceed / Has warnings]

Keep report SHORT and SCANNABLE. No fluff.`;
                    break;

                case 'schema': {
                    const schemaHours = p.hoursDetail ? p.hoursDetail.join('\n') : (p.hours || '[HOURS]');
                    text = `${forcePrefix}TASK: GENERATE SCHEMA (JSON-LD)

City: ${city}
CID (VERIFIED - Decimal Format): ${cid}

COMPLETE GMB DATA FOR SCHEMA:
═══════════════════════════════════
Business Name: ${p.name || 'STS Electronic Recycling - ' + city}
Category: ${p.category || 'RecyclingCenter'}
Full Address: ${p.fullAddress || '[FULL ADDRESS]'}
Street: ${p.address || '[STREET]'}
City: ${city}
State: ${state || '[STATE]'}
ZIP: ${p.zip || '[ZIP]'}
Phone: ${p.phone || '[PHONE]'}
Website: ${p.website || 'https://www.stselectronicrecyclinginc.com'}

Hours:
${schemaHours}
═══════════════════════════════════

REQUIREMENTS:
1. Type: LocalBusiness (or RecyclingCenter)
2. Include COMPLETE address with street, city, state, zip
3. Include phone number exactly as shown
4. Include ALL business hours
5. Add CID to "sameAs" array: https://www.google.com/maps?cid=${cid}
6. Include "Electronic Recycling" in name and description
7. Wrap in <script type="application/ld+json"> tags
8. Do NOT include aggregateRating/reviews

Output the complete schema script block.`;
                    break;
                }

                case 'schema-verify':
                    text = `${forcePrefix}TASK: SCHEMA VERIFICATION AUDIT

This schema was just generated. Verify it against current best practices.

════════════════════════════════════════════════════════
PART 1: STRUCTURAL COMPLIANCE CHECK
════════════════════════════════════════════════════════

Verify these required elements:

REQUIRED FIELDS:
☐ @context: "https://schema.org"
☐ @type: LocalBusiness (or valid subtype)
☐ name: Present and accurate
☐ address: Complete PostalAddress object
☐ telephone: Present with proper format
☐ url: Present and valid
☐ openingHoursSpecification: All days included

ADDRESS OBJECT:
☐ @type: "PostalAddress"
☐ streetAddress: Present
☐ addressLocality: City present
☐ addressRegion: State present
☐ postalCode: ZIP present
☐ addressCountry: "US"

RECOMMENDED:
☐ sameAs: Array with Google Maps CID link
☐ geo: GeoCoordinates (if available)
☐ areaServed: Defined service area
☐ priceRange: Present
☐ image: Business image URL

MUST NOT HAVE:
☐ NO aggregateRating (removed per policy)
☐ NO review data
☐ NO fake/placeholder data

════════════════════════════════════════════════════════
PART 2: WEB SEARCH — CURRENT BEST PRACTICES
════════════════════════════════════════════════════════

Search the web for:
• "LocalBusiness schema best practices 2025"
• "Google structured data requirements local business"
• "JSON-LD local business schema updates"

Check for:
1. Any NEW required fields added recently
2. Deprecated properties to avoid
3. Google's current validation requirements
4. Common errors that cause rich results rejection

════════════════════════════════════════════════════════
PART 3: RECOMMENDATIONS
════════════════════════════════════════════════════════

Based on your audit:
1. List any CRITICAL issues (will fail validation)
2. List any WARNINGS (may reduce effectiveness)
3. List any ENHANCEMENTS (optional improvements)

If schema passes all checks: "✅ SCHEMA VERIFIED — Ready for deployment"

Keep response focused. No unnecessary explanations.`;
                    break;

                case 'meta':
                    text = `Generate SEO meta data for: ${pageName}

OUTPUT FORMAT — Copy/paste boxes ONLY, no explanations:

┌─────────────────────────────────────┐
│ BROWSER TITLE (max 60 chars)        │
├─────────────────────────────────────┤
│ [title here]                        │
└─────────────────────────────────────┘

┌─────────────────────────────────────┐
│ META DESCRIPTION (max 160 chars)    │
├─────────────────────────────────────┤
│ [description here]                  │
└─────────────────────────────────────┘

┌─────────────────────────────────────┐
│ FOCUS KEYWORDS (comma separated)    │
├─────────────────────────────────────┤
│ [10 keywords here]                  │
└─────────────────────────────────────┘

Requirements:
- Title must include "${city}" + "Electronic Recycling"
- Description must be compelling with CTA
- Keywords focused on ${city} local SEO

ALSO: Re-display the HTML artifact and Schema artifact from earlier in this chat (unchanged) so I can easily access them.

Keep response TIGHT. Boxes only, no fluff.`;
                    break;
            }

            navigator.clipboard.writeText(text).then(() => {
                showToast("Prompt Copied!");
            }).catch(err => {
                console.error('Copy failed:', err);
                showToast("Copy failed - try again", true);
            });
        }

        // === UTILS ===
        function togglePhase(id) {
            document.getElementById(id).classList.toggle('active');
        }

        function updateProgress() {
            const total = document.querySelectorAll('#phases input[type="checkbox"]').length;
            const checked = document.querySelectorAll('#phases input[type="checkbox"]:checked').length;
            const percent = total > 0 ? Math.round((checked / total) * 100) : 0;
            
            document.getElementById('progressBar').style.width = percent + '%';
            document.getElementById('percentDisplay').textContent = percent + '%';
            
            document.querySelectorAll('input[type="checkbox"]').forEach(cb => {
                const step = cb.closest('.step');
                if(step) {
                    if(cb.checked) step.classList.add('checked');
                    else step.classList.remove('checked');
                }
            });
            saveState();
            
            // Check for phase completion
            checkPhaseCompletion();
        }

        function updateProgressBar() {
            const total = document.querySelectorAll('#phases input[type="checkbox"]').length;
            const checked = document.querySelectorAll('#phases input[type="checkbox"]:checked').length;
            const percent = total > 0 ? Math.round((checked / total) * 100) : 0;
            document.getElementById('progressBar').style.width = percent + '%';
            document.getElementById('percentDisplay').textContent = percent + '%';
        }

        function updateTimer() {
            if(!appState.startTime) return;
            const diff = Math.floor((Date.now() - appState.startTime) / 1000);
            const m = Math.floor(diff / 60).toString().padStart(2, '0');
            const s = (diff % 60).toString().padStart(2, '0');
            document.getElementById('timerDisplay').textContent = `${m}:${s}`;
        }

        function showToast(msg, isError = false) {
            const toast = document.getElementById('toast');
            toast.innerHTML = `<i class="fas ${isError ? 'fa-exclamation-circle' : 'fa-check-circle'}"></i> <span>${msg}</span>`;
            toast.style.borderLeft = isError ? '4px solid #ef4444' : '4px solid #34d399';
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 3000);
        }

        function generateReport() {
            const total = document.querySelectorAll('#phases input[type="checkbox"]').length;
            const checked = document.querySelectorAll('#phases input[type="checkbox"]:checked').length;
            const percent = Math.round((checked/total)*100);
            const status = checked === total ? '✅ COMPLETE' : '⚠️ INCOMPLETE';
            
            const report = `🤖 M.A.R.K. BUILD REPORT
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📄 ${appState.pageName || 'N/A'}
🔗 ${appState.pageURL || 'N/A'}
📍 ${appState.city || 'N/A'}${appState.state ? ', ' + appState.state : ''}

🆔 CID: ${appState.cid || 'N/A'}
📞 ${appState.parsedGMB?.phone || 'N/A'}
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
👤 ${appState.vaName || 'N/A'} • ⏱️ ${document.getElementById('timerDisplay').textContent}
📊 ${checked}/${total} (${percent}%) ${status}`;

            navigator.clipboard.writeText(report).then(() => {
                showToast("Report copied!");
            });
        }
    </script>

    <!-- TECHNICAL DOCUMENTATION FOOTER -->
    <footer style="max-width:900px; margin:60px auto 40px; padding:0 20px;">
        <div style="border-top:1px solid var(--border-light); padding-top:30px;">
            <div style="font-family:'Inter', sans-serif; font-size:11px; color:var(--text-secondary); line-height:1.9;">
                <div style="margin-bottom:15px; font-size:10px; color:var(--gold); font-weight:600; letter-spacing:2px; text-transform:uppercase;">
                    System Architecture
                </div>
                <p style="margin-bottom:12px;">
                    <strong style="color:var(--navy);">The M.A.R.K. Algorithm:</strong> Machine Assisted Routing Kit is a deterministic workflow orchestration system designed to minimize human error variance in high-volume landing page deployment. The algorithm operates on a principle of progressive data enrichment — where each phase inherits validated outputs from preceding phases, creating an immutable chain of verified data states.
                </p>
                <p style="margin-bottom:12px;">
                    <strong style="color:var(--navy);">GEO-PARSE™ Engine:</strong> City extraction utilizes a multi-tiered resolution cascade. Primary resolution queries a pre-indexed hashmap of 317 US metropolitan statistical areas sorted by descending key-length to prevent substring collision. Secondary resolution employs negative-space tokenization against a 47-term exclusion lexicon.
                </p>
                <p style="margin-bottom:12px;">
                    <strong style="color:var(--navy);">CID Verification Protocol:</strong> Google Place Identifiers are extracted via dual-mode regex parsing targeting hexadecimal pair structures embedded in Google Maps canonical URLs. Verification requires user-initiated confirmation via external redirect to prevent false-positive schema injection.
                </p>
            </div>
            
            <!-- FORENSIC TIMELINE -->
            <div style="margin-top:25px; padding-top:20px; border-top:1px solid var(--border-light);">
                <div style="font-family:'Inter', sans-serif; font-size:10px; color:var(--text-muted); line-height:1.8;">
                    <strong style="color:var(--text-secondary);">Development:</strong> v1.0–v6.x core parsing & UI scaffolding. v7.x 317-MSA city lookup, CID regex overhaul, 9-phase workflow. v9.97 Luxury UI redesign with refined boot sequence, elegant status bar, and sophisticated completion celebration. <strong style="color:var(--text-secondary);">42.0 man-hours</strong> | Jan 29, 2026
                </div>
            </div>
            
            <div style="margin-top:25px; padding-top:20px; border-top:1px solid var(--border-light); display:flex; justify-content:space-between; align-items:center;">
                <div style="font-size:11px; color:var(--text-muted);">
                    M.A.R.K<span style="color:var(--gold);">.</span> v9.97
                </div>
                <div style="font-size:10px; color:var(--text-muted);">
                    Page Terminal System
                </div>
            </div>
        </div>
    </footer>

    <!-- 100% COMPLETION CELEBRATION -->
    <div class="completion-overlay" id="completionOverlay">
        <div class="completion-box">
            <div class="completion-title">Mission <span>Complete</span></div>
            <div class="completion-stats">
                <div>Page: <span id="completionPage">—</span></div>
                <div>Time: <span id="completionTime">—</span></div>
                <div>Phases: <span>9/9</span></div>
                <div>Status: <span style="color: var(--gold);">Ready for Deployment</span></div>
            </div>
            <button class="completion-close" onclick="closeCompletion()">Continue</button>
        </div>
    </div>

</body>
</html>
